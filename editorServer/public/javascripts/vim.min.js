/*!
 * js-vim
 * Copyright(c) 2013 Joe Sullivan <itsjoesullivan@gmail.com>
 * MIT Licensed
 */

!function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){var View=module.exports=function(obj){if(!obj)throw"No configuration object";if(!obj.el)throw"No element!";this.el=obj.el;this.setup();this.getDimensions()};View.prototype.getDimensions=function(){var character=document.createElement("span");character.innerHTML="a";this.pre.appendChild(character);var char2=document.createElement("span");char2.innerHTML="b";this.pre.appendChild(char2);var char3=document.createElement("pre");char3.style.margin="0px";char3.innerHTML="c";this.pre.appendChild(char3);var charHeight=char3.offsetTop-character.offsetTop;var charWidth=char2.offsetLeft-character.offsetLeft;var charDimensions=[charWidth,charHeight];var elDimensions=[parseInt(this.pre.offsetWidth),parseInt(this.pre.offsetHeight)];this.dimensions=[Math.floor(elDimensions[0]/charDimensions[0]),Math.floor((elDimensions[1]-14)/charDimensions[1])];this.pre.removeChild(character);this.pre.removeChild(char2);this.pre.removeChild(char3)};View.prototype.setup=function(){var pre=document.createElement("pre");pre.className="vim-container";this.pre=pre;this.el.appendChild(pre)};View.prototype.write=function(text){this.pre.innerHTML=text};function isCursor(pos){var cursor=vim.cursor().position();return pos[1]===cursor.line&&pos[0]===cursor.char}function isSelection(pos){var selection=vim.curDoc.selection();if(typeof pos==="number"){return pos>=selection[0].line&&pos<=selection[1].line}else{pos={line:pos[1],"char":pos[0]}}if(pos.line<selection[0].line||pos.line>selection[1].line)return false;if(pos.line===selection[0].line&&selection[0].line===selection[1].line){return pos.char>=selection[0].char&&pos.char<selection[1].char}if(pos.line===selection[0].line){return pos.char>=selection[0].char}if(pos.line===selection[1].line){return pos.char<selection[1].char}return true}function gutterTemplate(index){var gutter=document.createElement("span");gutter.className="gutter";var text="    "+(index+1);while(text.length<4){text+=" "}while(text.length>4){text=text.substring(1)}text+=" ";gutter.innerHTML=text;return gutter}},{}],2:[function(require,module,exports){var Vim=require("js-vim"),ElView=require("./lib/View"),Keys=require("./lib/keys");require("./lib/style");var init=function(obj){window.vim=new Vim;var elView;vim.edit=function(obj){if(!obj||typeof obj!=="object"||!("el"in obj))throw"vim.edit required { el: <HTMLElement> }";var text=obj.el.innerHTML;obj.el.innerHTML="";elView=new ElView({el:obj.el});vim.view.lines=elView.dimensions[1];vim.view.cols=elView.dimensions[0];if(text.length){vim.curDoc.text(text);vim.exec("G");vim.exec("$")}};vim.view.on("change",function(){elView.write(vim.view.getText())});keys=new Keys;keys.listen(document);keys.fn=function(key){vim.exec(key)}};init()},{"./lib/View":1,"./lib/keys":3,"./lib/style":4,"js-vim":5}],4:[function(require,module,exports){!function(){var style=document.createElement("style");var text=require("../style.css");style.setAttribute("type","text/css");if(style.styleSheet){style.styleSheet.cssText=text}else{var textnode=document.createTextNode(text);style.appendChild(textnode)}var h=document.getElementsByTagName("head")[0];h.appendChild(style)}()},{"../style.css":6}],3:[function(require,module,exports){mousetrap=require("../components/component-mousetrap");var Keys=module.exports=function(){this.fn=function(){}};var addListener=function(obj,verb,fn){if("addEventListener"in obj){obj.addEventListener(verb,fn)}else{obj.attachEvent("on"+verb,fn)}};var specialChars={enter:"\n",tab:"	",escape:"esc",backspace:"\b",space:" ",meta:"",shift:""};var reverseShiftMap={};for(var i in mousetrap.SHIFT_MAP){reverseShiftMap[""+mousetrap.SHIFT_MAP[i]]=""+i}Keys.prototype.listen=function(obj){addListener(obj,"keydown",function(e){var key=mousetrap.characterFromEvent(e);if(e.metaKey)return;if(key==="ctrl")return;var prefix="",suffix="";if(e.ctrlKey){prefix="<Ctrl-";suffix=">"}if(e.shiftKey){if(key in reverseShiftMap){key=reverseShiftMap[key]}else{key=key.toUpperCase()}}if(key.toLowerCase()in specialChars){e.preventDefault();key=specialChars[key];if(!key||!key.length)return}key=prefix+key+suffix;this.fn(key)}.bind(this))}},{"../components/component-mousetrap":7}],6:[function(require,module,exports){module.exports='.vim-container{margin:0;padding:0;position:relative;height:100%;width:100%;border-radius:4px;color:#f4f4f4;background-color:#111;font-size:14px;font-family:"Courier New", Courier, monospace}.vim-container pre,.vim-container span{font-size:inherit}.vim-container .selection{background-color:#555}.vim-container .selection.cursor{background-color:#888;color:#333}.vim-container .gutter{color:#ca792d;font-weight:700}.vim-container .blank{color:#4a39de;font-weight:700}.vim-container .var{color:#c0bb31}'},{}],5:[function(require,module,exports){module.exports=require("./lib/Vim")},{"./lib/Vim":8}],7:[function(require,module,exports){var _MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\","{":"[","}":"]"},_SPECIAL_ALIASES={option:"alt",command:"meta","return":"enter",escape:"esc"},_REVERSE_MAP,_callbacks={},_direct_map={},_sequence_levels={},_reset_timer,_ignore_next_keyup=false,_inside_sequence=false;for(var i=1;i<20;++i){_MAP[111+i]="f"+i}for(i=0;i<=9;++i){_MAP[i+96]=i}function _addEvent(object,type,callback){if(object.addEventListener){return object.addEventListener(type,callback,false)}object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if(e.type=="keypress"){return String.fromCharCode(e.which)}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _stop(e){var element=e.target||e.srcElement,tag_name=element.tagName;if((" "+element.className+" ").indexOf(" mousetrap ")>-1){return false}return tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="TEXTAREA"||element.contentEditable&&element.contentEditable=="true"}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(do_not_reset){do_not_reset=do_not_reset||{};var active_sequences=false,key;for(key in _sequence_levels){if(do_not_reset[key]){active_sequences=true;continue}_sequence_levels[key]=0}if(!active_sequences){_inside_sequence=false}}function _getMatches(character,modifiers,action,remove,combination){var i,callback,matches=[];if(!_callbacks[character]){return[]}if(action=="keyup"&&_isModifier(character)){modifiers=[character]}for(i=0;i<_callbacks[character].length;++i){callback=_callbacks[character][i];if(callback.seq&&_sequence_levels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if(action=="keypress"||_modifiersMatch(modifiers,callback.modifiers)){if(remove&&callback.combo==combination){_callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push("shift")}if(e.altKey){modifiers.push("alt")}if(e.ctrlKey){modifiers.push("ctrl")}if(e.metaKey){modifiers.push("meta")}return modifiers}function _fireCallback(callback,e){if(callback(e)===false){if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}e.returnValue=false;e.cancelBubble=true}}function _handleCharacter(character,e){if(_stop(e)){return}var callbacks=_getMatches(character,_eventModifiers(e),e.type),i,do_not_reset={},processed_sequence_callback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){processed_sequence_callback=true;do_not_reset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e);continue}if(!processed_sequence_callback&&!_inside_sequence){_fireCallback(callbacks[i].callback,e)}}if(e.type==_inside_sequence&&!_isModifier(character)){_resetSequences(do_not_reset)}}function _handleKey(e){e.which=typeof e.which=="number"?e.which:e.keyCode;var character=_characterFromEvent(e);if(!character){return}if(e.type=="keyup"&&_ignore_next_keyup==character){_ignore_next_keyup=false;return}_handleCharacter(character,e)}function _isModifier(key){return key=="shift"||key=="ctrl"||key=="alt"||key=="meta"}function _resetSequenceTimer(){clearTimeout(_reset_timer);_reset_timer=setTimeout(_resetSequences,1e3)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?"keydown":"keypress"}if(action=="keypress"&&modifiers.length){action="keydown"}return action}function _bindSequence(combo,keys,callback,action){_sequence_levels[combo]=0;if(!action){action=_pickBestAction(keys[0],[])}var _increaseSequence=function(e){_inside_sequence=action;++_sequence_levels[combo];_resetSequenceTimer()},_callbackAndReset=function(e){_fireCallback(callback,e);if(action!=="keyup"){_ignore_next_keyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)},i;for(i=0;i<keys.length;++i){_bindSingle(keys[i],i<keys.length-1?_increaseSequence:_callbackAndReset,action,combo,i)}}function _bindSingle(combination,callback,action,sequence_name,level){combination=combination.replace(/\s+/g," ");var sequence=combination.split(" "),i,key,keys,modifiers=[];if(sequence.length>1){return _bindSequence(combination,sequence,callback,action)}keys=combination==="+"?["+"]:combination.split("+");for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!="keypress"&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);if(!_callbacks[key]){_callbacks[key]=[]}_getMatches(key,modifiers,action,!sequence_name,combination);_callbacks[key][sequence_name?"unshift":"push"]({callback:callback,modifiers:modifiers,action:action,seq:sequence_name,level:level,combo:combination})}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}}_addEvent(document,"keypress",_handleKey);_addEvent(document,"keydown",_handleKey);_addEvent(document,"keyup",_handleKey);var mousetrap={bind:function(keys,callback,action){_bindMultiple(keys instanceof Array?keys:[keys],callback,action);_direct_map[keys+":"+action]=callback;return this},unbind:function(keys,action){if(_direct_map[keys+":"+action]){delete _direct_map[keys+":"+action];this.bind(keys,function(){},action)}return this},trigger:function(keys,action){_direct_map[keys+":"+action]();return this},reset:function(){_callbacks={};_direct_map={};return this}};module.exports=mousetrap;module.exports.characterFromEvent=_characterFromEvent;module.exports.SHIFT_MAP=_SHIFT_MAP},{}],9:[function(require,module,exports){module.exports={"/(.*)\n/":function(keys,vim,res){vim.searchBuffer=res[1];var lastMode=vim.lastMode||"command";vim.mode(lastMode);vim.exec("n")}}},{}],10:[function(require,module,exports){!function(){function parseRange(range,doc){if(range===".-")range=".-1";if(range==="-")range=".-1";if(range===".+")range=".+1";if(range==="+")range=".+1";var cur=doc.cursor.line(),last=doc._lines.length-1;if(range.indexOf(",")>-1){var split=range.split(",");return[parseRange(split[0],doc)[0],parseRange(split[1],doc)[1]]}var num=parseInt(range);if(""+num===range)return[num-1,num-1];if(range===""||range===".")return[cur,cur];if(range.match(/\.(\+|-)/)){var val=parseInt(range.substring(1));return[cur+val,cur+val]}if(range==="%")return[0,last];if(range==="$")return[last,last];return[cur,cur]}module.exports=function(Vim){Vim.addCommand({mode:"command",match:/:(.+)s(?:ubstitute)?(\/.*\n)/,fn:function(keys,vim,expr){var position=this.curDoc.cursor.position();var range=expr[1];range=parseRange(expr[1],this.curDoc);var line=range[1];while(line>=range[0]){vim.curDoc.cursor.line(line);vim.exec(":s"+expr[2]);line--}this.curDoc.cursor.line(position.line);this.curDoc.cursor.char(position.char)}});Vim.addCommand({mode:"command",match:/:s(\/.*\n)/,fn:function(keys,vim,expr){vim.exec(keys.replace(/:s/,":substitute"))}});Vim.addCommand({mode:"command",match:/:substitute\/([^\/]*)\/([^\/]*)\n/,fn:function(keys,vim,expr){vim.exec(keys.replace(/\n/,"/\n"))}});Vim.addCommand({mode:"command",match:/:substitute\/(.*)\/(.*)\/([gci]*)\n/,fn:function(res,vim,expr){var pos=this.curDoc.cursor.position();var flags=(expr[3]||"").split("");val=this.curDoc.find(new RegExp("("+expr[1]+")","g"),{wholeLine:true,range:false});while(val.found){this.curDoc.cursor.char(val.char);this.curDoc.cursor.line(val.line);vim.exec("v");for(var i=1;i<expr[1].length;i++){vim.exec("l")}vim.exec("c");vim.exec(expr[2]);vim.exec("esc");if(flags.indexOf("g")===-1)break;val=this.curDoc.find(new RegExp("("+expr[1]+")","g"),{wholeLine:true,range:false})}this.curDoc.cursor.char(pos.char);this.curDoc.cursor.line(pos.line)}});Vim.addCommand({mode:"command",match:/:substitute\/([^\/]*)\/([^\/]*)\n/,fn:function(keys,vim,expr){vim.exec(keys.replace(/\n/,"/\n"))}});Vim.addCommand({mode:"command",match:/:(.*)g\/([^\/]*)\/([^\/]*)\n/,fn:function(keys,vim,expr){var range=parseRange(expr[1],this.curDoc),pattern=expr[2],command=expr[3];var cur=this.curDoc.cursor.position();var end=range[1];while(end>=range[0]){}}})};module.exports.parseRange=parseRange}()},{}],8:[function(require,module,exports){var Set=require("get-set"),_=require("underscore");var mark=require("./mark");var Doc=require("./Doc"),View=require("./View"),CommandParser=require("js-vim-command");Vim=function(obj){this.view=new View({vim:this});this.docs=[];this._numRegistry=[];this._registry={};this.currentRegister=0;this.insertSession="";this.histories={":":[]};this.histories[":"].position=0;this.marks={};this.rc={tabstop:4,smartindent:true,shiftwidth:4,abbreviations:{}};this.curChar="";this.curWord="";this.parser=new CommandParser;var dmpmod=require("diff_match_patch");this.dmp=new dmpmod.diff_match_patch;this.execDepth=0;this.modes={};this.keyBuffer="";this.keyHistory="";var doc=new Doc;doc.vim=this;this.add(doc);this.on("change:status",function(){this.trigger("change")}.bind(this));this.addMode("insert",require("./modes/insert"));this.addMode("command",require("./modes/command"));this.addMode("search",require("./modes/search"));this.addMode("visual",require("./modes/visual"));require("./modes/ex")(this);this.mode("command")};Vim.prototype=new Set;Vim.prototype.new=function(){var doc=new Doc;doc.cursor.line(0);doc.cursor.char(0);this.docs.push(doc);this.curDoc=doc;this.exec("esc")};Vim.prototype.addMode=function(name,mode){var modeArr=[];for(var i in mode){if(mode.hasOwnProperty(i)){var reg=new RegExp(i.substring(1,i.length-1));this.addCommand({mode:name,match:reg,fn:mode[i]})}}};Vim.prototype.addCommand=function(obj){if(!obj||typeof obj!=="object"||!obj.mode||!obj.match||!obj.fn)throw"Invalid argument";if(!(obj.mode in this.modes))this.modes[obj.mode]=[];return this.modes[obj.mode].push({command:obj.match,fn:obj.fn})};Vim.prototype.mode=function(name){if(name){if(!(name in this.modes))throw"Mode "+name+" does not exist";this._mode=this.modes[name];this.modeName=name;this.trigger("change:mode",this._mode);this.trigger("change",{type:"mode"})}return this._mode};Vim.prototype.register=function(k,v){var num=typeof k==="number";if(v){if(_(v).isArray())v=v.slice(0);if(num){this._numRegistry.splice(k,0,v);this._numRegistry.splice(10)}else{this._registry[k]=v;this.register(0,v)}}else{var val;if(num){val=this._numRegistry[k]}else if(k==="%"){if("path"in this.curDoc&&typeof this.curDoc.path==="string"){return/(?:\/|^)([^\/]*)$/.exec(this.curDoc.path)[1]}}else{val=this._registry[k]}if(_(val).isArray())val=val.slice(0);return val?val:""}};Vim.prototype.useRegister=function(){var index=this.currentRegister||0;this.currentRegister=0;var val="asdf";return val};var _text="";var abbreviationKeyMap={" ":1,"\n":1,esc:1};Vim.prototype.exec=function(newCommand){if(this.keyBuffer.length){this.keyBuffer+=newCommand}else{this.keyBuffer=newCommand}if(this.execDepth===1){this.keyHistory+=newCommand}command=this.keyBuffer;if(this.execDepth<2){this.trigger("change:keyBuffer",this.keyBuffer);this.trigger("change")}this.curChar=this.curDoc.getRange(this.curDoc.selection()).substring(0,1);if(typeof command!=="string"&&!("marks"in command)){for(var i in command){if(command.hasOwnProperty(i)){this.exec(command[i])}}return}this.execDepth++;if(this.modeName==="insert"&&this.execDepth===1&&command in abbreviationKeyMap&&abbreviationKeyMap[command]&&this.currentInsertedText.length>=this.curWord.length){if(this.curWord in this.rc.abbreviations){var key=command;var curWord=this.curWord;var newWord=this.rc.abbreviations[this.curWord];var pos=this.curDoc.cursor.position();this.curDoc.remove([{line:pos.line,"char":pos.char-curWord.length},{line:pos.line,"char":pos.char}]);this.curDoc.cursor.char(pos.char-curWord.length);this.curDoc.insert(newWord)}}var startPos=this.curDoc.cursor.position();var mode=this.mode();var arg,regResult;if(this.keyBuffer.indexOf(":")===0&&this.keyBuffer.lastIndexOf("\n")===this.keyBuffer.length-1){this.histories[":"].push(this.keyBuffer.substring(1,this.keyBuffer.length-1));this.histories[":"].position=this.histories[":"].length}var parsedCommand=this.parser.parse(command);if(parsedCommand&&parsedCommand.description.lastIndexOf("{")===0)parsedCommand=false;if(parsedCommand.description==="{operator}{operator}")parsedCommand=false;if(parsedCommand.description==="{count}{operator}")parsedCommand=false;if(parsedCommand.description==="{count}{operator}{operator}")parsedCommand=false;if(command.indexOf(":")===0){parsedCommand=false}if(command.indexOf("?")===0){parsedCommand=false}if(command.indexOf("/")===0){parsedCommand=false}if(command.indexOf("<")>-1&&command.indexOf(">")>-1){parsedCommand=false}var handlers=[];var mode=this.mode();handlers=_(this.mode()).filter(function(mode){var res;if(command===mode.command)return true;if(typeof mode.command==="string")return;if(parsedCommand){res=mode.command.exec(parsedCommand.description);if(res)return true}else if("exec"in mode.command){res=mode.command.exec(command)}else{return}if(res){regResult=res;arg=command;return true}});if(handlers.length){if(this.recording&&this.execDepth===1&&command.indexOf("q")!==0){this.recordingBuffer.push(command)}this.lastKeyBuffer=command;this.keyBuffer="";if(parsedCommand){handlers[0].fn.apply(this,parsedCommand.value)}else{handlers[0].fn.bind(this)(arg,this,regResult)}}if(command==="esc"){this.mode("command");this.keyBuffer=""}if(this.execDepth===1){this.trigger("change:keyBuffer",command);this.trigger("exec",command)}this.curChar=this.curDoc.getRange(this.curDoc.selection()).substring(0,1);this.curWord=getCurWord(this);this.execDepth--;if(this.execDepth===0){this.trigger("idle")}};function getCurWord(vim){var doc=vim.curDoc;var startPoint=doc.find(/(?:^|\W)(\w+)$/g,{backwards:true,inclusive:true});var endPoint;if(vim.modeName==="insert"){endPoint=doc.find(/(\w)$/g,{backwards:true,inclusive:true})}else{endPoint=doc.find(/(\w)(?:$|\W)/g,{inclusive:true})}endPoint.col++;endPoint.char++;if(endPoint.found&&startPoint.found){var word=doc.getRange([startPoint,endPoint]);return word}else{return""}}Vim.prototype.addUndoState=function(){var pos=this.curDoc.cursor.position();var result=this.curDoc.undo.add({text:this.curDoc.text(),cursor:pos,keys:this.keyHistory});if(result)this.keyHistory="";return result};Vim.prototype.add=function(doc){doc.on("change:cursor",function(){this.trigger("change")}.bind(this));doc.on("change:text",function(){this.trigger("change:text");this.trigger("change",{type:"text"})}.bind(this));this.docs.push(doc);this.curDoc=doc;this.doc=this.curDoc;this.trigger("change")};Vim.prototype.notify=function(text){this.view.status=text};Vim.prototype.insert=function(){return this.curDoc.insert.apply(this.curDoc,arguments)};Vim.prototype.remove=function(){return this.curDoc.remove.apply(this.curDoc,arguments)};Vim.prototype.text=function(){return this.curDoc.text.apply(this.curDoc,arguments)};Vim.prototype.cursor=function(){return this.curDoc.cursor};Vim.prototype.Doc=Doc;module.exports=Vim},{"./mark":11,"./Doc":12,"./View":13,"./modes/insert":14,"./modes/command":15,"./modes/search":9,"./modes/visual":16,"./modes/ex":10,"get-set":17,underscore:18,"js-vim-command":19,diff_match_patch:20}],18:[function(require,module,exports){!function(){!function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.4.4";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value});return results};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?null:[];return _[first?"find":"filter"](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false}return true})};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true)};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})});return result.value};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})});return result.value};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value||_.identity);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){if(!_.has(result,key))result[key]=0;result[key]++})};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return n!=null&&!guard?slice.call(array,0,n):array[0]};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n!=null&&!guard){return slice.call(array,Math.max(array.length-n,0))}else{return array[array.length-1]}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,"length"));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(args,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,l+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step}return range};_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)))}};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};
hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait){var context,args,timeout,result;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args)}};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.times=function(n,iterator,context){var accum=Array(n);for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}.call(this)}()},{}],21:[function(require,module,exports){module.exports=function(){};module.exports.prototype.on=function(name,fn){var events=this.events=this.events||{};events[name]=events[name]||[];events[name].push(fn);return this};module.exports.prototype.trigger=function(name,arg1,arg2){if(!this.events||!this.events[name])return this;var listeners=this.events[name],args=Array.prototype.slice.call(arguments,1);function triggerFunction(fn){fn.apply(this,args)}if("forEach"in listeners){listeners.forEach(triggerFunction.bind(this))}else{for(var i in listeners){if(listeners.hasOwnProperty(i))triggerFunction(fn)}}return this}},{}],22:[function(require,module,exports){var Undo=module.exports=function(){this._history=[];this.position=0};Undo.prototype.add=function(ev){if(this.position&&typeof ev!=="string"&&"cursor"in ev&&"text"in ev){var current=this._history.slice(this.position-1,this.position)[0];var next=this._history.slice(this.position,this.position+1);next=next.length?next[0]:false;if(areSame(ev,current)||next&&areSame(ev,next)){return}}this._history.splice(this.position);this._history.push(ev);this.position++;return true};function areSame(ev1,ev2){return ev1.text===ev2.text}Undo.prototype.get=function(index){if(index<0||index>=this._history.length)return;var state=this._history.slice(index,index+1)[0];this.position=index;return state};Undo.prototype.last=function(){return this.get(this.position-1)};Undo.prototype.next=function(){return this.get(this.position+1)}},{}],19:[function(require,module,exports){var Parser=function(){};Parser.prototype.parse=function(command){var motion=this.getLastMotion(command);var prefix=command;var command={description:"",value:[]};var next;while(prefix.length){next=this.getLastCount(prefix)||this.getLastMotion(prefix)||this.getLastOperator(prefix);if(!next)break;prefix=next.prefix;command.description=next.description+command.description;command.value.unshift(next.value);command.prefix=next.prefix}return command.description.length?command:false;var x=this.getLastCount(command)||this.getLastMotion(command)||this.getLastOperator(command)};var opTest=new RegExp("(.*?)(c|d|y|~|g~|gu|gU|!|=|gg|g\\?|>|<|zf|g@)$");Parser.prototype.getLastOperator=function(command){var op=opTest.exec(command);if(!op)return;return{description:"{operator}",value:op[2],prefix:op[1]}};var motions=["h","%","l","0","\\$","\\^","g_","\\|","(?:'|`)(?:[a-z])","(?:f|F|t|T)(?:.)",";",",","k","j","\\+","-","_","(?:[1-9]+[0-9]*|)G","e","E","w","W","b","B","ge","gE","\\(","\\)","\\{","\\}","\\]\\]","\\]\\[","\\[\\[","\\[\\]","(?:\\?|\\/)(?:\\S+)\\n","~"];var motionTest=new RegExp("(.*?)("+motions.join("|")+")$");Parser.prototype.getLastMotion=function(command){var motion=motionTest.exec(command);if(!motion)return;return{description:"{motion}",value:motion[2],prefix:motion[1]}};var countTest=/(.*?)([1-9]+[0-9]*)$/;Parser.prototype.getLastCount=function(command){var countResult=countTest.exec(command);if(!countResult)return;return{description:"{count}",value:parseInt(countResult[2]),prefix:countResult[1]}};module.exports=Parser},{}],20:[function(require,module,exports){!function(){function diff_match_patch(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Diff_DualThreshold=32;this.Match_Threshold=.5;this.Match_Distance=1e3;this.Patch_DeleteThreshold=.5;this.Patch_Margin=4;function getMaxBits(){var maxbits=0;var oldi=1;var newi=2;while(oldi!=newi){maxbits++;oldi=newi;newi=newi<<1}return maxbits}this.Match_MaxBits=getMaxBits()}var DIFF_DELETE=-1;var DIFF_INSERT=1;var DIFF_EQUAL=0;diff_match_patch.prototype.diff_main=function(text1,text2,opt_checklines){if(text1==null||text2==null){throw new Error("Null input. (diff_main)")}if(text1==text2){return[[DIFF_EQUAL,text1]]}if(typeof opt_checklines=="undefined"){opt_checklines=true}var checklines=opt_checklines;var commonlength=this.diff_commonPrefix(text1,text2);var commonprefix=text1.substring(0,commonlength);text1=text1.substring(commonlength);text2=text2.substring(commonlength);commonlength=this.diff_commonSuffix(text1,text2);var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength);text2=text2.substring(0,text2.length-commonlength);var diffs=this.diff_compute(text1,text2,checklines);if(commonprefix){diffs.unshift([DIFF_EQUAL,commonprefix])}if(commonsuffix){diffs.push([DIFF_EQUAL,commonsuffix])}this.diff_cleanupMerge(diffs);return diffs};diff_match_patch.prototype.diff_compute=function(text1,text2,checklines){var diffs;if(!text1){return[[DIFF_INSERT,text2]]}if(!text2){return[[DIFF_DELETE,text1]]}var longtext=text1.length>text2.length?text1:text2;var shorttext=text1.length>text2.length?text2:text1;var i=longtext.indexOf(shorttext);if(i!=-1){diffs=[[DIFF_INSERT,longtext.substring(0,i)],[DIFF_EQUAL,shorttext],[DIFF_INSERT,longtext.substring(i+shorttext.length)]];if(text1.length>text2.length){diffs[0][0]=diffs[2][0]=DIFF_DELETE}return diffs}longtext=shorttext=null;var hm=this.diff_halfMatch(text1,text2);if(hm){var text1_a=hm[0];var text1_b=hm[1];var text2_a=hm[2];var text2_b=hm[3];var mid_common=hm[4];var diffs_a=this.diff_main(text1_a,text2_a,checklines);var diffs_b=this.diff_main(text1_b,text2_b,checklines);return diffs_a.concat([[DIFF_EQUAL,mid_common]],diffs_b)}if(checklines&&(text1.length<100||text2.length<100)){checklines=false}var linearray;if(checklines){var a=this.diff_linesToChars(text1,text2);text1=a[0];text2=a[1];linearray=a[2]}diffs=this.diff_map(text1,text2);if(!diffs){diffs=[[DIFF_DELETE,text1],[DIFF_INSERT,text2]]}if(checklines){this.diff_charsToLines(diffs,linearray);this.diff_cleanupSemantic(diffs);diffs.push([DIFF_EQUAL,""]);var pointer=0;var count_delete=0;var count_insert=0;var text_delete="";var text_insert="";while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;text_insert+=diffs[pointer][1];break;case DIFF_DELETE:count_delete++;text_delete+=diffs[pointer][1];break;case DIFF_EQUAL:if(count_delete>=1&&count_insert>=1){var a=this.diff_main(text_delete,text_insert,false);diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert);pointer=pointer-count_delete-count_insert;for(var j=a.length-1;j>=0;j--){diffs.splice(pointer,0,a[j])}pointer=pointer+a.length}count_insert=0;count_delete=0;text_delete="";text_insert="";break}pointer++}diffs.pop()}return diffs};diff_match_patch.prototype.diff_linesToChars=function(text1,text2){var lineArray=[];var lineHash={};lineArray[0]="";function diff_linesToCharsMunge(text){var chars="";var lineStart=0;var lineEnd=-1;var lineArrayLength=lineArray.length;while(lineEnd<text.length-1){lineEnd=text.indexOf("\n",lineStart);if(lineEnd==-1){lineEnd=text.length-1}var line=text.substring(lineStart,lineEnd+1);lineStart=lineEnd+1;if(lineHash.hasOwnProperty?lineHash.hasOwnProperty(line):lineHash[line]!==undefined){chars+=String.fromCharCode(lineHash[line])}else{chars+=String.fromCharCode(lineArrayLength);lineHash[line]=lineArrayLength;lineArray[lineArrayLength++]=line}}return chars}var chars1=diff_linesToCharsMunge(text1);var chars2=diff_linesToCharsMunge(text2);return[chars1,chars2,lineArray]};diff_match_patch.prototype.diff_charsToLines=function(diffs,lineArray){for(var x=0;x<diffs.length;x++){var chars=diffs[x][1];var text=[];for(var y=0;y<chars.length;y++){text[y]=lineArray[chars.charCodeAt(y)]}diffs[x][1]=text.join("")}};diff_match_patch.prototype.diff_map=function(text1,text2){var ms_end=(new Date).getTime()+this.Diff_Timeout*1e3;var text1_length=text1.length;var text2_length=text2.length;var max_d=text1_length+text2_length-1;var doubleEnd=this.Diff_DualThreshold*2<max_d;var v_map1=[];var v_map2=[];var v1={};var v2={};v1[1]=0;v2[1]=0;var x,y;var footstep;var footsteps={};var done=false;var front=(text1_length+text2_length)%2;for(var d=0;d<max_d;d++){if(this.Diff_Timeout>0&&(new Date).getTime()>ms_end){return null}v_map1[d]={};for(var k=-d;k<=d;k+=2){if(k==-d||k!=d&&v1[k-1]<v1[k+1]){x=v1[k+1]}else{x=v1[k-1]+1}y=x-k;if(doubleEnd){footstep=x+","+y;if(front&&footsteps[footstep]!==undefined){done=true}if(!front){footsteps[footstep]=d}}while(!done&&x<text1_length&&y<text2_length&&text1.charAt(x)==text2.charAt(y)){x++;y++;if(doubleEnd){footstep=x+","+y;if(front&&footsteps[footstep]!==undefined){done=true}if(!front){footsteps[footstep]=d}}}v1[k]=x;v_map1[d][x+","+y]=true;if(x==text1_length&&y==text2_length){return this.diff_path1(v_map1,text1,text2)}else if(done){v_map2=v_map2.slice(0,footsteps[footstep]+1);var a=this.diff_path1(v_map1,text1.substring(0,x),text2.substring(0,y));return a.concat(this.diff_path2(v_map2,text1.substring(x),text2.substring(y)))}}if(doubleEnd){v_map2[d]={};for(var k=-d;k<=d;k+=2){if(k==-d||k!=d&&v2[k-1]<v2[k+1]){x=v2[k+1]}else{x=v2[k-1]+1}y=x-k;footstep=text1_length-x+","+(text2_length-y);if(!front&&footsteps[footstep]!==undefined){done=true}if(front){footsteps[footstep]=d}while(!done&&x<text1_length&&y<text2_length&&text1.charAt(text1_length-x-1)==text2.charAt(text2_length-y-1)){x++;y++;footstep=text1_length-x+","+(text2_length-y);if(!front&&footsteps[footstep]!==undefined){done=true}if(front){footsteps[footstep]=d}}v2[k]=x;v_map2[d][x+","+y]=true;if(done){v_map1=v_map1.slice(0,footsteps[footstep]+1);var a=this.diff_path1(v_map1,text1.substring(0,text1_length-x),text2.substring(0,text2_length-y));return a.concat(this.diff_path2(v_map2,text1.substring(text1_length-x),text2.substring(text2_length-y)))}}}}return null};diff_match_patch.prototype.diff_path1=function(v_map,text1,text2){var path=[];var x=text1.length;var y=text2.length;var last_op=null;for(var d=v_map.length-2;d>=0;d--){while(1){if(v_map[d][x-1+","+y]!==undefined){x--;if(last_op===DIFF_DELETE){path[0][1]=text1.charAt(x)+path[0][1]}else{path.unshift([DIFF_DELETE,text1.charAt(x)])}last_op=DIFF_DELETE;break}else if(v_map[d][x+","+(y-1)]!==undefined){y--;if(last_op===DIFF_INSERT){path[0][1]=text2.charAt(y)+path[0][1]}else{path.unshift([DIFF_INSERT,text2.charAt(y)])}last_op=DIFF_INSERT;break}else{x--;y--;if(text1.charAt(x)!=text2.charAt(y)){throw new Error("No diagonal.  Can't happen. (diff_path1)")}if(last_op===DIFF_EQUAL){path[0][1]=text1.charAt(x)+path[0][1]}else{path.unshift([DIFF_EQUAL,text1.charAt(x)])}last_op=DIFF_EQUAL}}}return path};diff_match_patch.prototype.diff_path2=function(v_map,text1,text2){var path=[];var pathLength=0;var x=text1.length;var y=text2.length;var last_op=null;for(var d=v_map.length-2;d>=0;d--){while(1){if(v_map[d][x-1+","+y]!==undefined){x--;if(last_op===DIFF_DELETE){path[pathLength-1][1]+=text1.charAt(text1.length-x-1)}else{path[pathLength++]=[DIFF_DELETE,text1.charAt(text1.length-x-1)]}last_op=DIFF_DELETE;break}else if(v_map[d][x+","+(y-1)]!==undefined){y--;if(last_op===DIFF_INSERT){path[pathLength-1][1]+=text2.charAt(text2.length-y-1)}else{path[pathLength++]=[DIFF_INSERT,text2.charAt(text2.length-y-1)]}last_op=DIFF_INSERT;break}else{x--;y--;if(text1.charAt(text1.length-x-1)!=text2.charAt(text2.length-y-1)){throw new Error("No diagonal.  Can't happen. (diff_path2)")}if(last_op===DIFF_EQUAL){path[pathLength-1][1]+=text1.charAt(text1.length-x-1)}else{path[pathLength++]=[DIFF_EQUAL,text1.charAt(text1.length-x-1)]}last_op=DIFF_EQUAL}}}return path};diff_match_patch.prototype.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charAt(0)!=text2.charAt(0)){return 0}var pointermin=0;var pointermax=Math.min(text1.length,text2.length);var pointermid=pointermax;var pointerstart=0;while(pointermin<pointermid){if(text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)){pointermin=pointermid;pointerstart=pointermin}else{pointermax=pointermid}pointermid=Math.floor((pointermax-pointermin)/2+pointermin)}return pointermid};diff_match_patch.prototype.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charAt(text1.length-1)!=text2.charAt(text2.length-1)){return 0}var pointermin=0;var pointermax=Math.min(text1.length,text2.length);var pointermid=pointermax;var pointerend=0;while(pointermin<pointermid){if(text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)){pointermin=pointermid;pointerend=pointermin}else{pointermax=pointermid}pointermid=Math.floor((pointermax-pointermin)/2+pointermin)}return pointermid};diff_match_patch.prototype.diff_halfMatch=function(text1,text2){var longtext=text1.length>text2.length?text1:text2;var shorttext=text1.length>text2.length?text2:text1;if(longtext.length<10||shorttext.length<1){return null}var dmp=this;function diff_halfMatchI(longtext,shorttext,i){var seed=longtext.substring(i,i+Math.floor(longtext.length/4));var j=-1;var best_common="";var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b;while((j=shorttext.indexOf(seed,j+1))!=-1){var prefixLength=dmp.diff_commonPrefix(longtext.substring(i),shorttext.substring(j));var suffixLength=dmp.diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));if(best_common.length<suffixLength+prefixLength){best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength);best_longtext_a=longtext.substring(0,i-suffixLength);best_longtext_b=longtext.substring(i+prefixLength);best_shorttext_a=shorttext.substring(0,j-suffixLength);best_shorttext_b=shorttext.substring(j+prefixLength)}}if(best_common.length>=longtext.length/2){return[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]}else{return null}}var hm1=diff_halfMatchI(longtext,shorttext,Math.ceil(longtext.length/4));var hm2=diff_halfMatchI(longtext,shorttext,Math.ceil(longtext.length/2));var hm;if(!hm1&&!hm2){return null}else if(!hm2){hm=hm1}else if(!hm1){hm=hm2}else{hm=hm1[4].length>hm2[4].length?hm1:hm2}var text1_a,text1_b,text2_a,text2_b;if(text1.length>text2.length){text1_a=hm[0];text1_b=hm[1];text2_a=hm[2];text2_b=hm[3]}else{text2_a=hm[0];text2_b=hm[1];text1_a=hm[2];text1_b=hm[3]}var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]};diff_match_patch.prototype.diff_cleanupSemantic=function(diffs){var changes=false;var equalities=[];var equalitiesLength=0;var lastequality=null;var pointer=0;var length_changes1=0;var length_changes2=0;while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){equalities[equalitiesLength++]=pointer;length_changes1=length_changes2;length_changes2=0;lastequality=diffs[pointer][1]}else{length_changes2+=diffs[pointer][1].length;if(lastequality!==null&&lastequality.length<=length_changes1&&lastequality.length<=length_changes2){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;equalitiesLength--;pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;length_changes1=0;length_changes2=0;lastequality=null;changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}this.diff_cleanupSemanticLossless(diffs)};diff_match_patch.prototype.diff_cleanupSemanticLossless=function(diffs){var punctuation=/[^a-zA-Z0-9]/;var whitespace=/\s/;var linebreak=/[\r\n]/;var blanklineEnd=/\n\r?\n$/;var blanklineStart=/^\r?\n\r?\n/;function diff_cleanupSemanticScore(one,two){if(!one||!two){return 5}var score=0;if(one.charAt(one.length-1).match(punctuation)||two.charAt(0).match(punctuation)){score++;if(one.charAt(one.length-1).match(whitespace)||two.charAt(0).match(whitespace)){score++;if(one.charAt(one.length-1).match(linebreak)||two.charAt(0).match(linebreak)){score++;if(one.match(blanklineEnd)||two.match(blanklineStart)){score++}}}}return score}var pointer=1;while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){var equality1=diffs[pointer-1][1];var edit=diffs[pointer][1];var equality2=diffs[pointer+1][1];var commonOffset=this.diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset);edit=commonString+edit.substring(0,edit.length-commonOffset);equality2=commonString+equality2}var bestEquality1=equality1;var bestEdit=edit;var bestEquality2=equality2;var bestScore=diff_cleanupSemanticScore(equality1,edit)+diff_cleanupSemanticScore(edit,equality2);while(edit.charAt(0)===equality2.charAt(0)){equality1+=edit.charAt(0);edit=edit.substring(1)+equality2.charAt(0);equality2=equality2.substring(1);var score=diff_cleanupSemanticScore(equality1,edit)+diff_cleanupSemanticScore(edit,equality2);if(score>=bestScore){bestScore=score;bestEquality1=equality1;bestEdit=edit;bestEquality2=equality2}}if(diffs[pointer-1][1]!=bestEquality1){if(bestEquality1){diffs[pointer-1][1]=bestEquality1}else{diffs.splice(pointer-1,1);pointer--}diffs[pointer][1]=bestEdit;if(bestEquality2){diffs[pointer+1][1]=bestEquality2}else{diffs.splice(pointer+1,1);pointer--}}}pointer++}};diff_match_patch.prototype.diff_cleanupEfficiency=function(diffs){var changes=false;var equalities=[];var equalitiesLength=0;var lastequality="";var pointer=0;var pre_ins=false;var pre_del=false;var post_ins=false;var post_del=false;while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){if(diffs[pointer][1].length<this.Diff_EditCost&&(post_ins||post_del)){equalities[equalitiesLength++]=pointer;pre_ins=post_ins;pre_del=post_del;lastequality=diffs[pointer][1]}else{equalitiesLength=0;lastequality=""}post_ins=post_del=false}else{if(diffs[pointer][0]==DIFF_DELETE){post_del=true}else{post_ins=true}if(lastequality&&(pre_ins&&pre_del&&post_ins&&post_del||lastequality.length<this.Diff_EditCost/2&&pre_ins+pre_del+post_ins+post_del==3)){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;lastequality="";if(pre_ins&&pre_del){post_ins=post_del=true;equalitiesLength=0}else{equalitiesLength--;pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;post_ins=post_del=false}changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}};diff_match_patch.prototype.diff_cleanupMerge=function(diffs){diffs.push([DIFF_EQUAL,""]);var pointer=0;var count_delete=0;var count_insert=0;var text_delete="";var text_insert="";var commonlength;while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;text_insert+=diffs[pointer][1];pointer++;break;case DIFF_DELETE:count_delete++;text_delete+=diffs[pointer][1];pointer++;break;case DIFF_EQUAL:if(count_delete!==0||count_insert!==0){if(count_delete!==0&&count_insert!==0){commonlength=this.diff_commonPrefix(text_insert,text_delete);if(commonlength!==0){if(pointer-count_delete-count_insert>0&&diffs[pointer-count_delete-count_insert-1][0]==DIFF_EQUAL){diffs[pointer-count_delete-count_insert-1][1]+=text_insert.substring(0,commonlength)}else{diffs.splice(0,0,[DIFF_EQUAL,text_insert.substring(0,commonlength)]);pointer++}text_insert=text_insert.substring(commonlength);text_delete=text_delete.substring(commonlength)}commonlength=this.diff_commonSuffix(text_insert,text_delete);if(commonlength!==0){diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1];text_insert=text_insert.substring(0,text_insert.length-commonlength);text_delete=text_delete.substring(0,text_delete.length-commonlength)}}if(count_delete===0){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_INSERT,text_insert])}else if(count_insert===0){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete])}else{diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete],[DIFF_INSERT,text_insert])}pointer=pointer-count_delete-count_insert+(count_delete?1:0)+(count_insert?1:0)+1}else if(pointer!==0&&diffs[pointer-1][0]==DIFF_EQUAL){diffs[pointer-1][1]+=diffs[pointer][1];diffs.splice(pointer,1)}else{pointer++}count_insert=0;count_delete=0;text_delete="";text_insert="";break}}if(diffs[diffs.length-1][1]===""){diffs.pop()}var changes=false;pointer=1;while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){if(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)==diffs[pointer-1][1]){diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length);diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1];diffs.splice(pointer-1,1);changes=true}else if(diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]){diffs[pointer-1][1]+=diffs[pointer+1][1];diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1];diffs.splice(pointer+1,1);changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}};diff_match_patch.prototype.diff_xIndex=function(diffs,loc){var chars1=0;var chars2=0;var last_chars1=0;var last_chars2=0;var x;for(x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_INSERT){chars1+=diffs[x][1].length}if(diffs[x][0]!==DIFF_DELETE){chars2+=diffs[x][1].length}if(chars1>loc){break}last_chars1=chars1;last_chars2=chars2}if(diffs.length!=x&&diffs[x][0]===DIFF_DELETE){return last_chars2}return last_chars2+(loc-last_chars1)};diff_match_patch.prototype.diff_prettyHtml=function(diffs){var html=[];var i=0;for(var x=0;x<diffs.length;x++){var op=diffs[x][0];var data=diffs[x][1];var text=data.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(op){case DIFF_INSERT:html[x]='<INS STYLE="background:#E6FFE6;" TITLE="i='+i+'">'+text+"</INS>";break;case DIFF_DELETE:html[x]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+i+'">'+text+"</DEL>";break;case DIFF_EQUAL:html[x]='<SPAN TITLE="i='+i+'">'+text+"</SPAN>";break}if(op!==DIFF_DELETE){i+=data.length}}return html.join("")};diff_match_patch.prototype.diff_text1=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_INSERT){text[x]=diffs[x][1]}}return text.join("")};diff_match_patch.prototype.diff_text2=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_DELETE){text[x]=diffs[x][1]}}return text.join("")};diff_match_patch.prototype.diff_levenshtein=function(diffs){var levenshtein=0;var insertions=0;var deletions=0;for(var x=0;x<diffs.length;x++){var op=diffs[x][0];var data=diffs[x][1];switch(op){case DIFF_INSERT:insertions+=data.length;break;case DIFF_DELETE:deletions+=data.length;break;case DIFF_EQUAL:levenshtein+=Math.max(insertions,deletions);insertions=0;deletions=0;break}}levenshtein+=Math.max(insertions,deletions);return levenshtein};diff_match_patch.prototype.diff_toDelta=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){switch(diffs[x][0]){case DIFF_INSERT:text[x]="+"+encodeURI(diffs[x][1]);break;case DIFF_DELETE:text[x]="-"+diffs[x][1].length;break;case DIFF_EQUAL:text[x]="="+diffs[x][1].length;break}}return text.join("	").replace(/\x00/g,"%00").replace(/%20/g," ")};diff_match_patch.prototype.diff_fromDelta=function(text1,delta){var diffs=[];var diffsLength=0;var pointer=0;delta=delta.replace(/%00/g,"\0");var tokens=delta.split(/\t/g);for(var x=0;x<tokens.length;x++){var param=tokens[x].substring(1);switch(tokens[x].charAt(0)){case"+":try{diffs[diffsLength++]=[DIFF_INSERT,decodeURI(param)]
}catch(ex){throw new Error("Illegal escape in diff_fromDelta: "+param)}break;case"-":case"=":var n=parseInt(param,10);if(isNaN(n)||n<0){throw new Error("Invalid number in diff_fromDelta: "+param)}var text=text1.substring(pointer,pointer+=n);if(tokens[x].charAt(0)=="="){diffs[diffsLength++]=[DIFF_EQUAL,text]}else{diffs[diffsLength++]=[DIFF_DELETE,text]}break;default:if(tokens[x]){throw new Error("Invalid diff operation in diff_fromDelta: "+tokens[x])}}}if(pointer!=text1.length){throw new Error("Delta length ("+pointer+") does not equal source text length ("+text1.length+").")}return diffs};diff_match_patch.prototype.match_main=function(text,pattern,loc){if(text==null||pattern==null||loc==null){throw new Error("Null input. (match_main)")}loc=Math.max(0,Math.min(loc,text.length));if(text==pattern){return 0}else if(!text.length){return-1}else if(text.substring(loc,loc+pattern.length)==pattern){return loc}else{return this.match_bitap(text,pattern,loc)}};diff_match_patch.prototype.match_bitap=function(text,pattern,loc){if(pattern.length>this.Match_MaxBits){throw new Error("Pattern too long for this browser.")}var s=this.match_alphabet(pattern);var dmp=this;function match_bitapScore(e,x){var accuracy=e/pattern.length;var proximity=Math.abs(loc-x);if(!dmp.Match_Distance){return proximity?1:accuracy}return accuracy+proximity/dmp.Match_Distance}var score_threshold=this.Match_Threshold;var best_loc=text.indexOf(pattern,loc);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore(0,best_loc),score_threshold);best_loc=text.lastIndexOf(pattern,loc+pattern.length);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore(0,best_loc),score_threshold)}}var matchmask=1<<pattern.length-1;best_loc=-1;var bin_min,bin_mid;var bin_max=pattern.length+text.length;var last_rd;for(var d=0;d<pattern.length;d++){bin_min=0;bin_mid=bin_max;while(bin_min<bin_mid){if(match_bitapScore(d,loc+bin_mid)<=score_threshold){bin_min=bin_mid}else{bin_max=bin_mid}bin_mid=Math.floor((bin_max-bin_min)/2+bin_min)}bin_max=bin_mid;var start=Math.max(1,loc-bin_mid+1);var finish=Math.min(loc+bin_mid,text.length)+pattern.length;var rd=Array(finish+2);rd[finish+1]=(1<<d)-1;for(var j=finish;j>=start;j--){var charMatch=s[text.charAt(j-1)];if(d===0){rd[j]=(rd[j+1]<<1|1)&charMatch}else{rd[j]=(rd[j+1]<<1|1)&charMatch|((last_rd[j+1]|last_rd[j])<<1|1)|last_rd[j+1]}if(rd[j]&matchmask){var score=match_bitapScore(d,j-1);if(score<=score_threshold){score_threshold=score;best_loc=j-1;if(best_loc>loc){start=Math.max(1,2*loc-best_loc)}else{break}}}}if(match_bitapScore(d+1,loc)>score_threshold){break}last_rd=rd}return best_loc};diff_match_patch.prototype.match_alphabet=function(pattern){var s={};for(var i=0;i<pattern.length;i++){s[pattern.charAt(i)]=0}for(var i=0;i<pattern.length;i++){s[pattern.charAt(i)]|=1<<pattern.length-i-1}return s};diff_match_patch.prototype.patch_addContext=function(patch,text){if(text.length==0){return}var pattern=text.substring(patch.start2,patch.start2+patch.length1);var padding=0;while(text.indexOf(pattern)!=text.lastIndexOf(pattern)&&pattern.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin){padding+=this.Patch_Margin;pattern=text.substring(patch.start2-padding,patch.start2+patch.length1+padding)}padding+=this.Patch_Margin;var prefix=text.substring(patch.start2-padding,patch.start2);if(prefix){patch.diffs.unshift([DIFF_EQUAL,prefix])}var suffix=text.substring(patch.start2+patch.length1,patch.start2+patch.length1+padding);if(suffix){patch.diffs.push([DIFF_EQUAL,suffix])}patch.start1-=prefix.length;patch.start2-=prefix.length;patch.length1+=prefix.length+suffix.length;patch.length2+=prefix.length+suffix.length};diff_match_patch.prototype.patch_make=function(a,opt_b,opt_c){var text1,diffs;if(typeof a=="string"&&typeof opt_b=="string"&&typeof opt_c=="undefined"){text1=a;diffs=this.diff_main(text1,opt_b,true);if(diffs.length>2){this.diff_cleanupSemantic(diffs);this.diff_cleanupEfficiency(diffs)}}else if(a&&typeof a=="object"&&typeof opt_b=="undefined"&&typeof opt_c=="undefined"){diffs=a;text1=this.diff_text1(diffs)}else if(typeof a=="string"&&opt_b&&typeof opt_b=="object"&&typeof opt_c=="undefined"){text1=a;diffs=opt_b}else if(typeof a=="string"&&typeof opt_b=="string"&&opt_c&&typeof opt_c=="object"){text1=a;diffs=opt_c}else{throw new Error("Unknown call format to patch_make.")}if(diffs.length===0){return[]}var patches=[];var patch=new patch_obj;var patchDiffLength=0;var char_count1=0;var char_count2=0;var prepatch_text=text1;var postpatch_text=text1;for(var x=0;x<diffs.length;x++){var diff_type=diffs[x][0];var diff_text=diffs[x][1];if(!patchDiffLength&&diff_type!==DIFF_EQUAL){patch.start1=char_count1;patch.start2=char_count2}switch(diff_type){case DIFF_INSERT:patch.diffs[patchDiffLength++]=diffs[x];patch.length2+=diff_text.length;postpatch_text=postpatch_text.substring(0,char_count2)+diff_text+postpatch_text.substring(char_count2);break;case DIFF_DELETE:patch.length1+=diff_text.length;patch.diffs[patchDiffLength++]=diffs[x];postpatch_text=postpatch_text.substring(0,char_count2)+postpatch_text.substring(char_count2+diff_text.length);break;case DIFF_EQUAL:if(diff_text.length<=2*this.Patch_Margin&&patchDiffLength&&diffs.length!=x+1){patch.diffs[patchDiffLength++]=diffs[x];patch.length1+=diff_text.length;patch.length2+=diff_text.length}else if(diff_text.length>=2*this.Patch_Margin){if(patchDiffLength){this.patch_addContext(patch,prepatch_text);patches.push(patch);patch=new patch_obj;patchDiffLength=0;prepatch_text=postpatch_text;char_count1=char_count2}}break}if(diff_type!==DIFF_INSERT){char_count1+=diff_text.length}if(diff_type!==DIFF_DELETE){char_count2+=diff_text.length}}if(patchDiffLength){this.patch_addContext(patch,prepatch_text);patches.push(patch)}return patches};diff_match_patch.prototype.patch_deepCopy=function(patches){var patchesCopy=[];for(var x=0;x<patches.length;x++){var patch=patches[x];var patchCopy=new patch_obj;patchCopy.diffs=[];for(var y=0;y<patch.diffs.length;y++){patchCopy.diffs[y]=patch.diffs[y].slice()}patchCopy.start1=patch.start1;patchCopy.start2=patch.start2;patchCopy.length1=patch.length1;patchCopy.length2=patch.length2;patchesCopy[x]=patchCopy}return patchesCopy};diff_match_patch.prototype.patch_apply=function(patches,text){if(patches.length==0){return[text,[]]}patches=this.patch_deepCopy(patches);var nullPadding=this.patch_addPadding(patches);text=nullPadding+text+nullPadding;this.patch_splitMax(patches);var delta=0;var results=[];for(var x=0;x<patches.length;x++){var expected_loc=patches[x].start2+delta;var text1=this.diff_text1(patches[x].diffs);var start_loc;var end_loc=-1;if(text1.length>this.Match_MaxBits){start_loc=this.match_main(text,text1.substring(0,this.Match_MaxBits),expected_loc);if(start_loc!=-1){end_loc=this.match_main(text,text1.substring(text1.length-this.Match_MaxBits),expected_loc+text1.length-this.Match_MaxBits);if(end_loc==-1||start_loc>=end_loc){start_loc=-1}}}else{start_loc=this.match_main(text,text1,expected_loc)}if(start_loc==-1){results[x]=false;delta-=patches[x].length2-patches[x].length1}else{results[x]=true;delta=start_loc-expected_loc;var text2;if(end_loc==-1){text2=text.substring(start_loc,start_loc+text1.length)}else{text2=text.substring(start_loc,end_loc+this.Match_MaxBits)}if(text1==text2){text=text.substring(0,start_loc)+this.diff_text2(patches[x].diffs)+text.substring(start_loc+text1.length)}else{var diffs=this.diff_main(text1,text2,false);if(text1.length>this.Match_MaxBits&&this.diff_levenshtein(diffs)/text1.length>this.Patch_DeleteThreshold){results[x]=false}else{this.diff_cleanupSemanticLossless(diffs);var index1=0;var index2;for(var y=0;y<patches[x].diffs.length;y++){var mod=patches[x].diffs[y];if(mod[0]!==DIFF_EQUAL){index2=this.diff_xIndex(diffs,index1)}if(mod[0]===DIFF_INSERT){text=text.substring(0,start_loc+index2)+mod[1]+text.substring(start_loc+index2)}else if(mod[0]===DIFF_DELETE){text=text.substring(0,start_loc+index2)+text.substring(start_loc+this.diff_xIndex(diffs,index1+mod[1].length))}if(mod[0]!==DIFF_DELETE){index1+=mod[1].length}}}}}}text=text.substring(nullPadding.length,text.length-nullPadding.length);return[text,results]};diff_match_patch.prototype.patch_addPadding=function(patches){var paddingLength=this.Patch_Margin;var nullPadding="";for(var x=1;x<=paddingLength;x++){nullPadding+=String.fromCharCode(x)}for(var x=0;x<patches.length;x++){patches[x].start1+=paddingLength;patches[x].start2+=paddingLength}var patch=patches[0];var diffs=patch.diffs;if(diffs.length==0||diffs[0][0]!=DIFF_EQUAL){diffs.unshift([DIFF_EQUAL,nullPadding]);patch.start1-=paddingLength;patch.start2-=paddingLength;patch.length1+=paddingLength;patch.length2+=paddingLength}else if(paddingLength>diffs[0][1].length){var extraLength=paddingLength-diffs[0][1].length;diffs[0][1]=nullPadding.substring(diffs[0][1].length)+diffs[0][1];patch.start1-=extraLength;patch.start2-=extraLength;patch.length1+=extraLength;patch.length2+=extraLength}patch=patches[patches.length-1];diffs=patch.diffs;if(diffs.length==0||diffs[diffs.length-1][0]!=DIFF_EQUAL){diffs.push([DIFF_EQUAL,nullPadding]);patch.length1+=paddingLength;patch.length2+=paddingLength}else if(paddingLength>diffs[diffs.length-1][1].length){var extraLength=paddingLength-diffs[diffs.length-1][1].length;diffs[diffs.length-1][1]+=nullPadding.substring(0,extraLength);patch.length1+=extraLength;patch.length2+=extraLength}return nullPadding};diff_match_patch.prototype.patch_splitMax=function(patches){for(var x=0;x<patches.length;x++){if(patches[x].length1>this.Match_MaxBits){var bigpatch=patches[x];patches.splice(x--,1);var patch_size=this.Match_MaxBits;var start1=bigpatch.start1;var start2=bigpatch.start2;var precontext="";while(bigpatch.diffs.length!==0){var patch=new patch_obj;var empty=true;patch.start1=start1-precontext.length;patch.start2=start2-precontext.length;if(precontext!==""){patch.length1=patch.length2=precontext.length;patch.diffs.push([DIFF_EQUAL,precontext])}while(bigpatch.diffs.length!==0&&patch.length1<patch_size-this.Patch_Margin){var diff_type=bigpatch.diffs[0][0];var diff_text=bigpatch.diffs[0][1];if(diff_type===DIFF_INSERT){patch.length2+=diff_text.length;start2+=diff_text.length;patch.diffs.push(bigpatch.diffs.shift());empty=false}else if(diff_type===DIFF_DELETE&&patch.diffs.length==1&&patch.diffs[0][0]==DIFF_EQUAL&&diff_text.length>2*patch_size){patch.length1+=diff_text.length;start1+=diff_text.length;empty=false;patch.diffs.push([diff_type,diff_text]);bigpatch.diffs.shift()}else{diff_text=diff_text.substring(0,patch_size-patch.length1-this.Patch_Margin);patch.length1+=diff_text.length;start1+=diff_text.length;if(diff_type===DIFF_EQUAL){patch.length2+=diff_text.length;start2+=diff_text.length}else{empty=false}patch.diffs.push([diff_type,diff_text]);if(diff_text==bigpatch.diffs[0][1]){bigpatch.diffs.shift()}else{bigpatch.diffs[0][1]=bigpatch.diffs[0][1].substring(diff_text.length)}}}precontext=this.diff_text2(patch.diffs);precontext=precontext.substring(precontext.length-this.Patch_Margin);var postcontext=this.diff_text1(bigpatch.diffs).substring(0,this.Patch_Margin);if(postcontext!==""){patch.length1+=postcontext.length;patch.length2+=postcontext.length;if(patch.diffs.length!==0&&patch.diffs[patch.diffs.length-1][0]===DIFF_EQUAL){patch.diffs[patch.diffs.length-1][1]+=postcontext}else{patch.diffs.push([DIFF_EQUAL,postcontext])}}if(!empty){patches.splice(++x,0,patch)}}}}};diff_match_patch.prototype.patch_toText=function(patches){var text=[];for(var x=0;x<patches.length;x++){text[x]=patches[x]}return text.join("")};diff_match_patch.prototype.patch_fromText=function(textline){var patches=[];if(!textline){return patches}textline=textline.replace(/%00/g,"\0");var text=textline.split("\n");var textPointer=0;while(textPointer<text.length){var m=text[textPointer].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!m){throw new Error("Invalid patch string: "+text[textPointer])}var patch=new patch_obj;patches.push(patch);patch.start1=parseInt(m[1],10);if(m[2]===""){patch.start1--;patch.length1=1}else if(m[2]=="0"){patch.length1=0}else{patch.start1--;patch.length1=parseInt(m[2],10)}patch.start2=parseInt(m[3],10);if(m[4]===""){patch.start2--;patch.length2=1}else if(m[4]=="0"){patch.length2=0}else{patch.start2--;patch.length2=parseInt(m[4],10)}textPointer++;while(textPointer<text.length){var sign=text[textPointer].charAt(0);try{var line=decodeURI(text[textPointer].substring(1))}catch(ex){throw new Error("Illegal escape in patch_fromText: "+line)}if(sign=="-"){patch.diffs.push([DIFF_DELETE,line])}else if(sign=="+"){patch.diffs.push([DIFF_INSERT,line])}else if(sign==" "){patch.diffs.push([DIFF_EQUAL,line])}else if(sign=="@"){break}else if(sign===""){}else{throw new Error('Invalid patch mode "'+sign+'" in: '+line)}textPointer++}}return patches};function patch_obj(){this.diffs=[];this.start1=null;this.start2=null;this.length1=0;this.length2=0}patch_obj.prototype.toString=function(){var coords1,coords2;if(this.length1===0){coords1=this.start1+",0"}else if(this.length1==1){coords1=this.start1+1}else{coords1=this.start1+1+","+this.length1}if(this.length2===0){coords2=this.start2+",0"}else if(this.length2==1){coords2=this.start2+1}else{coords2=this.start2+1+","+this.length2}var text=["@@ -"+coords1+" +"+coords2+" @@\n"];var op;for(var x=0;x<this.diffs.length;x++){switch(this.diffs[x][0]){case DIFF_INSERT:op="+";break;case DIFF_DELETE:op="-";break;case DIFF_EQUAL:op=" ";break}text[x+1]=op+encodeURI(this.diffs[x][1])+"\n"}return text.join("").replace(/\x00/g,"%00").replace(/%20/g," ")};exports["diff_match_patch"]=diff_match_patch;exports["patch_obj"]=patch_obj;exports["DIFF_DELETE"]=DIFF_DELETE;exports["DIFF_INSERT"]=DIFF_INSERT;exports["DIFF_EQUAL"]=DIFF_EQUAL}()},{}],17:[function(require,module,exports){var Event=require("./lib/event");var Set=module.exports=function(){};Set.prototype=new Event;Set.prototype.set=function(k,v){if(v===undefined){for(var i in k){this.set(i,k[i])}return}this[k]=v;this.trigger("change:"+k,v)};Set.prototype.get=function(k){return this[k]}},{"./lib/event":23}],11:[function(require,module,exports){var _=require("underscore");_.mixin({deepClone:function(p_object){return JSON.parse(JSON.stringify(p_object))}});function shallowCopy(obj){var newObj={};for(var i in obj){if(obj.hasOwnProperty(i)){newObj[i]=obj[i]}}return newObj}var mark=module.exports=function(str,mk){if(str.marks&!mk)return str;var tmpStr=new String(str);tmpStr.marks=[];if(str.marks)tmpStr.marks=_.deepClone(str.marks);str=tmpStr;if(mk){if("length"in mk){if(mk.length){str.marks=mk}}else{str.marks.push(mk)}}str._substring=str._substring||str.substring;str.substring=function(from,to){if(from===to)return mark("");var newString=mark(str._substring.apply(str,arguments));for(var i in str.marks){if(str.marks.hasOwnProperty(i)){if(str.marks[i].col>=from&&(!to&&to!==0||str.marks[i].col<to)){var newMark=shallowCopy(str.marks[i]);newMark.col=str.marks[i].col-from;newString.marks.push(newMark)}}}if(newString.length>to-from)throw"awwww";return newString};str._concat=str.concat;str.concat=function(incomingStr){var marks=str.marks;if(incomingStr.marks&&incomingStr.marks.length){for(var i in incomingStr.marks){if(incomingStr.marks.hasOwnProperty(i)){var newMark=incomingStr.marks[i];newMark.col+=str.length;marks.push(newMark)}}}return mark(str._concat(incomingStr),marks)};return str}},{underscore:18}],12:[function(require,module,exports){!function(){var Cursor=require("./Cursor");var _=require("underscore");var mark=require("./mark");var Event=require("./Event");Doc=function(obj){this.cursor=new Cursor;this.cursor.doc=this;this.cursor.on("change",function(){this.trigger("change:cursor")}.bind(this));this._text="";this._lines=[];this.undo.add({text:"",cursor:{"char":0,line:0}});this._marks={};this.selecting=false;this.yanking=false;if(typeof obj==="object"){if("text"in obj){this._text=obj.text}}this._selection=[];if(this._text.length)this._lines=this._text.split("\n")};Doc.prototype=new Event;var _lasts=[];Doc.prototype.last=function(k,v){if(v){_lasts[k]=v}return _lasts[k]};var Undo=require("./Undo");Doc.prototype.undo=new Undo;Doc.prototype.set=function(k,v){var obj;if(v&&typeof k==="string"){obj={};obj[k]=v;return this.set(obj)}obj=k;for(var i in obj){if(obj.hasOwnProperty(i)){this["_"+i]=obj[i];this.trigger("change:"+i,obj[i]);this.trigger("change")}}};Doc.prototype.text=function(text){if(text||text===""){if(typeof text==="string"){this._text=text;this._lines=this._text.split("\n");this.trigger("change:text")}else if("length"in text){return this._lines.slice.apply(this._lines,text).join("\n")}}return this._text};Doc.prototype.getRange=function(range){var text=mark("");if(!("line"in range[0])&&range[0][0]&&"line"in range[0][0]){_(range).each(function(subRange){text+=this.getRange(subRange)},this);return text}if(range[0].line===range[1].line){text=this.line(range[0].line).substring(parseInt(range[0].char),parseInt(range[1].char))}else{text=text.concat(this.line(range[0].line).substring(range[0].char));var middleLineCount=range[1].line-range[0].line;var ct=1;while(ct<middleLineCount){text=text.concat("\n").concat(this.line(range[0].line+ct));ct++}var lastLine=this.line(range[1].line);text=text.concat("\n").concat(lastLine.substring(0,range[1].char))}if(range[1].char>this.line(range[1].line).length){text=text.concat("\n")}return text};Doc.prototype.addMark=function(mk){if(!mk)return;if(!("line"in mk&&"col"in mk))throw"bad mark.";var markId=((new Date).getTime()+Math.random()).toString(16);mk.id=markId;this._marks[mk.mark]=mk;if(mk.mark===".")return;this._lines[mk.line]=mark(this._lines[mk.line],mk)};Doc.prototype.getMark=function(index){if(index===".")return this._marks["."];var markId=this._marks[index].id;var mark=false;_(this._lines).each(function(line,lineIndex){if(mark)return;if(line.marks&&line.marks.length){if(mark)return;_(line.marks).each(function(lineMark){if(lineMark.id===markId)mark=lineMark;mark.line=lineIndex})}});return mark};Doc.prototype.line=function(num){if(typeof num!=="number")num=this.cursor.line();if(this._lines.length<=num){if(this.cursor.line()===0){this._lines.push("")}else{console.log((new Error).stack);throw"Line out of range of document"}}return this._lines[num]};Doc.prototype.insert=function(text){if(typeof text!=="string"&!text.marks)throw"Only strings can be inserted into a doc";if(text.length>1){for(var i=0;i<text.length;i++){this.insert(text.substring(i,i+1))}return}var curLine=this.line();var lineBackup=mark(curLine,curLine.marks);curLine=curLine.substring(0,this.cursor.char());if(typeof text.marks!=="undefined"&&typeof curLine.marks==="undefined"){curLine=mark(curLine)}curLine=curLine.concat(text);curLine=curLine.concat(lineBackup.substring(this.cursor.char()));if(text.toString()==="\n"){var curLineIndex=this.cursor.line();var lines=curLine.split("\n");this._lines[curLineIndex]=lines[0];this._lines.splice(curLineIndex+1,0,lines[1]);this.cursor.line(curLineIndex+1);this.cursor.char(0)}else{this._lines[this.cursor.line()]=curLine;this.cursor.char(this.cursor.char()+text.length)}var pos=this.cursor.position();pos.mark=".";this.addMark(pos);this.set({text:this._lines.join("\n")});this.trigger("change")};Doc.prototype.remove=function(range){if(!isRange(range))throw"Not a valid range.";if(!("line"in range[0])){return _.each(range,function(subRange){this.remove(subRange)},this)}var first=this._lines[range[0].line].substring(0,range[0].char);var join=range[1].char>=this._lines[range[1].line].length?true:false;var last=this._lines[range[1].line].substring(range[1].char);var deleteLastLine=(!range[0].char||range[0].line<range[1].line)&&range[1].char>this.line(range[1].line).length;if(range[1].line>range[0].line)this._lines.splice(range[0].line+1,range[1].line-range[0].line);if(join&&!first.length&&range[0].line!==range[1].line){this._lines.splice(range[0].line,1)}else if(deleteLastLine){this._lines.splice(range[1].line,1)}else{this._lines[range[0].line]=first.concat(last)}var pos=this.cursor.position();pos.mark=".";this.addMark(pos);this.set({text:this._lines.join("\n")})};Doc.prototype.find=function(exp,opts){opts=opts||{};var carriage="",backwards=false,wholeLine=false,range=opts.range||opts.range===false?opts.range:"%",offset=0,inclusive=false;if(this.selecting){carriage="\n"}if("backwards"in opts&&opts.backwards){backwards=true}if("inclusive"in opts&&opts.inclusive){inclusive=true}if("wholeLine"in opts&&opts.wholeLine)wholeLine=true;if("offset"in opts&&opts.offset)offset=opts.offset;var rest;var thisLine=this.line()+carriage;var tmpOffset=0;if(offset){tmpOffset=offset}else if(wholeLine){tmpOffset=0}else{tmpOffset=this.cursor.char();if(backwards){}else{tmpOffset+=1}if(inclusive){if(backwards){tmpOffset+=1}else{tmpOffset-=1}}}var curIndex=checkString(exp,thisLine,tmpOffset,backwards);if(curIndex>-1){return{line:this.cursor.line(),"char":curIndex,found:true}}if(range){var lineIndex=this.cursor.line()+(backwards?-1:1);while(lineIndex<this._lines.length&&lineIndex>=0){var foundAt=checkString(exp,this._lines[lineIndex]+carriage,0,backwards);if(foundAt>-1)return{line:lineIndex,"char":foundAt,found:true};lineIndex+=backwards?-1:1}}var result=backwards?this.firstPosition():this.lastPosition();result.found=false;return result};Doc.prototype.lastPosition=function(){return{line:this._lines.length-1,"char":this._lines[this._lines.length-1].length-1}};Doc.prototype.firstPosition=function(){return{line:0,"char":0}};function checkString(exp,str,offset,backwards){if(!exp.global)throw"Regular expressions need to be global here";if(offset==null)offset=0;if(!backwards)exp.lastIndex=offset;if(backwards&&offset!==0)str=str.substring(0,offset);var test=exp.exec(str);if(!test)return-1;result=!!test[1]?test[1]:test[2];if(backwards){if(exp.toString().match(/[^\\^\[](\^)/)){return str.indexOf(result)}else{return str.lastIndexOf(result)}}else{return exp.lastIndex-test[0].length+test[0].indexOf(result)}}Doc.prototype.checkString=checkString;var _selection=false;Doc.prototype.selection=function(range){if(range==="reset"){_selection=false;return}if(range){_selection=range}else if(!_selection){var pos=this.cursor.position();var end={line:pos.line,"char":pos.char+1};return[pos,end]}return _selection};function isRange(range){if(!("line"in range[0])&&_(range[0]).isArray()){var areRanges=true;_.each(range,function(subRange){if(!isRange(subRange))areRanges=false});return areRanges}if(!range)return false;if(!("length"in range))return false;if(range.length!==2)return false;if("char"in range[0]&&"line"in range[0]&&"char"in range[1]&&"line"in range[1]){if(range[0].line>range[1].line)return false;if(range[0].line===range[1].line&&range[0].char>range[1].char)return false}else{return false}return true}Doc.prototype.inSelection=function(pos){};Doc.prototype.exec=function(){if("vim"in this)this.vim.exec.apply(this.vim,arguments)};module.exports=Doc}()},{"./Cursor":24,"./mark":11,"./Event":21,"./Undo":22,underscore:18}],24:[function(require,module,exports){var Event=require("./Event");var Cursor=function(obj){"use strict";this._line=0;this._char=0;if(typeof obj==="object"){if("line"in obj)this._line=obj.line;if("char"in obj)this._char=obj.char}this.moved=false;this.on("change",function(){this.moved=true})};Cursor.prototype=new Event;Cursor.prototype.line=function(num){if(typeof num==="number"&&this._line!==num){this._line=num;this.trigger("change:line",num);this.trigger("change")}if("doc"in this){if(this.doc._lines.length&&this.doc._lines.length<=this._line){this.line(this.doc._lines.length-1)}}return this._line};Cursor.prototype.col=function(num){if(typeof num==="number"&&this._char!==num){this._char=num;this.trigger("change:char",num);this.trigger("change")}if("doc"in this){if(this.doc.line().length<this._char){return this.doc.line().length}}return this._char};Cursor.prototype.char=function(){return this.col.apply(this,arguments)};Cursor.prototype.position=function(pos){if(pos){this.line(pos.line);this.char(pos.char)}return{line:this.line(),"char":this.char(),col:this.col()}};module.exports=Cursor},{"./Event":21}],13:[function(require,module,exports){var _=require("underscore"),Set=require("get-set");var mauve=require("mauve");mauve.set({idle:"#0000ff",gutter:"#d75f00",cursor:"/#555",status:"bold","entity.function":"#dc3",storage:"#21F","function.anonymous":"#1F1",selection:"#000/#fff"});var View=module.exports=function(obj){this.vim=obj.vim;this.color=true;this.lines=obj.lines||24;this.cols=obj.cols||80;this.lastVisibleLines=[0,1];this.vim.on("change",this.handleChange.bind(this));this.idle=false;this.vim.on("idle",function(){this.idle=true;this.handleChange.bind(this)}.bind(this));this.vim.on("change:status",function(){this.trigger("change")}.bind(this));this.status="";this.lineArray=[];this.focus=0};View.prototype=new Set;View.prototype.handleChange=function(){this.refreshStatusLine();this.getText();this.trigger("change");this.idle=false};var renderCt=0;View.prototype.refreshStatusLine=function(){if(this.notification){this.status=this.notification;this.notification=false;return this.status}if("insert,replace".indexOf(this.vim.modeName)!==-1){var text="-- "+this.vim.modeName.toUpperCase()+" --";this.status=this.color?mauve(text).status:text;return this.status}var keys=this.vim.keyBuffer;var firstKey=keys.substring(0,1);if(firstKey==="/"||firstKey==="?"||firstKey===":"){return this.status=this.vim.keyBuffer}this.status=""};View.prototype.getText=function(){var text=this.getArray().join("\n");return text};View.prototype.visibleLines=function(){if(this.lastVisibleLines[1]<this.lines){this.lastVisibleLines[1]=this.lines}var totalLines=this.lines-1;var cursorLine=this.vim.curDoc.cursor.line();if(cursorLine>=this.lastVisibleLines[1]){this.lastVisibleLines=[cursorLine-totalLines+1,cursorLine]}else if(cursorLine<this.lastVisibleLines[0]){this.lastVisibleLines=[cursorLine,cursorLine+totalLines]}if(this.lastVisibleLines[0]<0)this.lastVisibleLines[0]=0;return this.lastVisibleLines};View.prototype.getArray=function(){renderCt++;var visibleLines=this.visibleLines();var textArray=this.vim.curDoc._lines.slice(visibleLines[0],visibleLines[1]+1);var noLines=false;if(!textArray.length){this.notify="--No lines in buffer";noLines=true}var cursor=noLines?{line:0,"char":0}:this.vim.curDoc.cursor.position();var visibleCursorIndex=cursor.line-visibleLines[0];var cursorLine=textArray[visibleCursorIndex];if(!cursorLine){cursorLine=""}cursorLine+=" ";var selection=this.vim.curDoc.selection();var newLines=[];_(textArray).each(function(text,lineIndex){var newText="";if(lineIndex===cursor.line&&cursor.char>=text.length){text+=" "}_(text).each(function(character,charIndex){newText+=this.renderChar(character,{line:lineIndex,"char":charIndex},cursor,selection)},this);newLines[lineIndex]=newText},this);textArray=newLines;var lines=[];var linesLeft=this.lines;lines.unshift(this.status);linesLeft--;while(linesLeft>0){if(typeof textArray[linesLeft-1]!=="undefined"){var textLine=textArray[linesLeft-1];lines.unshift(this.renderLine(textLine,visibleLines[0]+linesLeft))}else{lines.splice(lines.length-1,0,!this.color?"~":mauve("~").idle)}linesLeft--}return lines};View.prototype.renderChar=function renderChar(character,position,cursor,selection){if(cursor.line===position.line&&cursor.char===position.char)return!this.color?character:mauve(character).cursor;if("line"in selection[0]){if(position.line<selection[0].line||position.line>selection[1].line)return character;if(position.line>selection[0].line&&position.line<selection[1].line)return!this.color?character:mauve(character).selection;if(position.line===selection[0].line&&position.line!==selection[1].line&&position.char>=selection[0].char)return!this.color?character:mauve(character).selection;if(position.line===selection[1].line&&position.line!==selection[0].line&&position.char<selection[1].char)return!this.color?character:mauve(character).selection;if(selection[0].line===selection[1].line&&position.line===selection[0].line){if(position.char>=selection[0].char&&position.char<selection[1].char)return!this.color?character:mauve(character).selection}}else{if(position.line<selection[0][0].line||position.line>selection[selection.length-1][1].line)return character;var result=false;_(selection).find(function(range){if(range[0].line===position.line&&position.char>=range[0].char&&position.char<range[1].char){result=!this.color?character:mauve(character).selection}},this);if(result)return character.selection}return character};View.prototype.getPatch=function(ref){this.renderText();var patch=[];var text=this.getText();if(!ref&&ref!=="")throw"No reference to diff!";var refLines=ref.split("\n");while(refLines.length<24){refLines.push("")}var textLines=text.split("\n");var lineIndex=0;_(refLines).each(function(line,i){var diff=this.diffLine(line,textLines[i]);_(diff).each(function(change){change.line=i+1;patch.push(change);lineIndex=i})}.bind(this));return patch};View.prototype.diffLine=function(line1,line2){var diffs=[];if(line1===line2)return[];if(!line2||!line2.length)return[{from:0,to:line1.length-1,content:""}];if(!line1||!line1.length)return[{from:0,to:line2.length-1,content:line2}];var len=Math.max(line1.length,line2.length);var diff=false;for(var i=0;i<len;i++){if(line1[i]===line2[i]){if(diff){diff.to=i;diffs.push(diff);diff=false}}else{if(diff){diff.content+=line2[i]?line2[i]:""}else{diff={from:i,content:line2[i]?line2[i]:""}}}}if(diff){diff.to=i;diffs.push(diff)}return diffs};View.prototype.renderText=function(){};View.prototype.renderLine=function(text,index,misc){var gutter="     "+index+" ";while(gutter.length>6){gutter=gutter.substring(1)}gutter=!this.color?gutter:mauve(gutter).gutter;return gutter+text};View.prototype.notify=function(text){this.notification=text;this.trigger("change:status")}},{underscore:18,"get-set":17,mauve:25}],23:[function(require,module,exports){module.exports=function(){};module.exports.prototype.on=function(name,fn){var events=this.events=this.events||{};events[name]=events[name]||[];events[name].push(fn);return this};module.exports.prototype.trigger=function(name,arg1,arg2){if(!this.events||!this.events[name])return this;var listeners=this.events[name],args=Array.prototype.slice.call(arguments,1);function triggerFunction(fn){fn.apply(this,args)}if("forEach"in listeners){listeners.forEach(triggerFunction.bind(this))}else{for(var i in listeners){if(listeners.hasOwnProperty(i))triggerFunction(fn)}}return this}},{}],15:[function(require,module,exports){var _=require("underscore");module.exports={"/^{count}{motion}$/":function(count,motion){while(count--){this.exec(motion)}},"/^{count}{operator}{count}{motion}$/":function(ct1,operator,ct2,motion){var count=ct1*ct2;this.exec(count+operator+motion)},"/^{operator}{motion}$/":function(operator,motion){this.exec("1"+operator+motion)},"/^{count}{operator}{motion}$/":function(count,operator,motion){this.addUndoState();var visualMode="v";if(motion.match(/gg|G|j|k|-|\+/)){visualMode="V"}if(operator==="d"||operator==="c"){if(motion==="w")motion="e"}var position=this.curDoc.cursor.position();this.exec(visualMode);this.exec(motion);this.exec(operator)},"/^(y|d|c)(i|a)(w|W|s|S|p|\\]|\\[|\\(|\\)|b|>|<|t|\\{|\\}|\"|'|`)$/":function(keys,vim,match){this.exec("v");this.exec(match[2]+match[3]);this.exec(match[1])},"/g_/":function(keys,vim){this.exec("$");var doc=this.curDoc;var point=doc.find(/([\S])( |$)/g,{backwards:true});if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}},"/^gv$/":function(){},"/^(b|B)/":function(keys,vim){var doc=this.curDoc;var point=doc.find(/(\S*)\s*(?=[\S]*)$/g,{backwards:true});if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}},"/^\\$$/":function(keys,vim){var curLine=this.curDoc.line();var cursorPos=0;if(curLine.length){cursorPos=curLine.length-1+(this.curDoc.selecting?1:0)}this.cursor().char(cursorPos)},"/^0$/":function(keys,vim){this.cursor().char(0)},"/^(w)$/":function(keys,vim){var doc=this.curDoc;var point;if(!this.curChar.match(/\s/)){if(this.curChar.match(/\w/)){point=doc.find(/(?:(?: |^)(\S)|([^\w^\s]))/g)}else{point=doc.find(/(?:(?: |^)([^\w^\s])|(\w))/g)
}}else{point=doc.find(/(\S)/g)}if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}},"/^(W)$/":function(keys,vim){var doc=this.curDoc;var point=doc.find(/(?: |^)(\S+)/g);if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}},"/^(e)$/":function(keys,vim){var doc=this.curDoc;var point=doc.find(/(\w)(?= |$|\n)/g);if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}},"/\\^/":function(keys,vim){this.exec("0");var doc=this.curDoc;if(this.curChar.match(/(\S)/g)===null){var point=doc.find(/(\S)/g);if(point){doc.cursor.line(point.line);doc.cursor.char(point.char)}}},"/^\\)$/":function(){var pt=this.curDoc.find(/(?:^|\. )(.)/g);if(pt)this.curDoc.cursor.position(pt)},"/^\\($/":function(){var pt=this.curDoc.find(/(?:\.|\?|\!) ([\w\s]+)(?:$)/g,{backwards:true});if(!pt.found){var pt=this.curDoc.find(/(?:\.|\?|\!) ([\w\s]+)(?:(?:\.|\?|\!)|$)/g,{backwards:true})}if(!pt.found){var pt=this.curDoc.find(/(?:^|(?:\.|\?|\!) )([\w\s]+)(?:(?:\.|\?|\!)|$)/g,{backwards:true})}if(pt)this.curDoc.cursor.position(pt)},"/^h$/":function(keys,vim){var newChar=this.cursor().char()-1;if(newChar<0)return;this.cursor().char(newChar)},"/^l$/":function(keys,vim){var newChar=this.cursor().char()+1;if(!this.curDoc.selecting&&newChar>=this.curDoc.line().length)return;this.cursor().char(newChar)},"/^j$/":function(keys,vim){var newLine=this.cursor().line()+1;if(newLine>=this.curDoc._lines.length)return;this.cursor().line(newLine)},"/^k$/":function(keys,vim){var newLine=this.cursor().line()-1;if(newLine<0)return;this.cursor().line(newLine)},"/^([1-9]+[0-9]*)$/":function(keys,vim,res){this.keyBuffer+=keys},"/^([1-9][0-9]*)G$":function(keys,vim,res){var lineNumber=parseInt(res[1])-1;if(this.curDoc._lines.length<=lineNumber){lineNumber=this.curDoc._lines.length-1}this.curDoc.cursor.line(lineNumber);this.exec("0")},"/^gg$/":function(keys,vim,res){this.exec("1G")},"/^G$/":function(keys,vim,res){this.exec(""+this.curDoc._lines.length+"G")},"/^f(.)$/":function(keys,vim,match){var lastSearch=this.curDoc.last("search");this.exec("/"+match[1]+"\n");this.curDoc.last("f","f"+match[1]);this.curDoc.last("search",lastSearch)},"/^F(.)$/":function(keys,vim,match){var lastSearch=this.curDoc.last("search");this.exec("?"+match[1]+"\n");this.curDoc.last("f","F"+match[1]);this.curDoc.last("search",lastSearch)},"/^t(.)$/":function(keys,vim,match){var lastSearch=this.curDoc.last("search");this.exec("l");this.exec("/"+match[1]+"\n");this.exec("h");this.curDoc.last("f","t"+match[1]);this.curDoc.last("search",lastSearch)},"^T(.)$":function(keys,vim,match){var lastSearch=this.curDoc.last("search");this.exec("h");this.exec("?"+match[1]+"\n");this.exec("l");this.curDoc.last("f","T"+match[1]);this.curDoc.last("search",lastSearch)},"/^;$/":function(vim){this.exec(this.curDoc.last("f"))},"/^,$/":function(vim){var last=this.curDoc.last("f");var lastOp=last.substring(0,1);if(lastOp===lastOp.toLowerCase()){lastOp=lastOp.toUpperCase()}else{lastOp=lastOp.toLowerCase()}this.exec(lastOp+last.substring(1));this.curDoc.last("f",last)},"/^(\\/|\\?)(.+)\\n/":function(keys,vim,match){this.curDoc.last("search",keys);this.searchMode=match[1]==="/"?"forwards":"backwards";this.searchBuffer=match[2];if(match[2].match(/"[a-z]/)){this.searchBuffer=this.register(match[2].substring(1))}var pt=this.curDoc.find(new RegExp("("+this.searchBuffer.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")","g"),{selection:true,backwards:vim.searchMode==="backwards"});if(pt){this.cursor().line(pt.line);this.cursor().char(pt.char)}},"/^n$/":function(keys,vim,res){this.exec(this.curDoc.last("search"))},"/^N$/":function(keys,vim,res){var last=this.curDoc.last("search");if(!last)return;if(last.substring(0,1)==="?"){newLast="/"+last.substring(1)}else{newLast="?"+last.substring(1)}this.exec(newLast);this.curDoc.last("search",last)},"/(esc)/":function(keys,vim){this.keyBuffer=""},"/^(i|s|S)/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}if(!this.curDoc._lines.length){this.curDoc._lines.push("")}this.currentInsertedText="";this.insertSession="";this.mode("insert")},"/^(A)$/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}this.exec("$");this.exec("a")},"/^(I)/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}this.exec("0");this.exec("i")},"/^v$/":function(keys,vim){var pos=this.curDoc.cursor.position();this.rangeStart=this.rangeEnd=pos;this.mode("visual")},"/^V$/":function(keys,vim){this.submode="Visual";this.exec("v")},"/^<Ctrl-v>$/":function(){this.submode="block";this.exec("v")},"/^J$/":function(keys,vim){this.exec("j");this.exec("0");this.exec("v");this.exec("$");this.exec("d");var copied=this.register(0);copied=copied.substring(0,copied.length-1);this.register(0,copied);this.exec("k");this.exec("$");var position=this.curDoc.cursor.char();this.exec("a");this.exec(" ");this.exec(copied);this.exec("esc");this.curDoc.selection("reset");this.exec("0");this.exec(position+1+"l")},"/^o$/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}this.exec("A");this.exec("\n")},"/^O$/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}this.exec("0");this.exec("i");this.exec("\n");this.exec("esc");this.exec("k");this.exec("i")},"/^a$/":function(keys,vim){if(this.execDepth===1){this.addUndoState()}this.exec("i");var doc=this.curDoc;doc.cursor.char(doc.cursor.char()+1)},"/^([1-9]+[0-9]*)?(yy|cc|dd)$/":function(keys,vim,match){if(this.execDepth===1){this.addUndoState()}var start=this.curDoc.cursor.position();this.exec("0");this.exec("v");var ct=1;var to=parseInt(match[1]);if(!to)to=1;while(ct<to){ct++;this.exec("j")}this.exec("$");var text=this.curDoc.getRange(this.curDoc.selection());if(text.substring(text.length-1)==="\n")text=text.substring(0,text.length-1);this.curDoc.yanking=false;if(match[2]==="cc"||match[2]==="dd"){this.exec("d")}this.curDoc.cursor.line(start.line);this.curDoc.cursor.char(start.char);if(match[2]==="cc"){this.exec("i")}var command=["o",text,"esc"];if(to>=2){command.push(to-1+"k")}command.push("0");this.register(this.currentRegister,command);this.curDoc.yanking=false},'/^"([a-z%.-_"#])$/':function(keys,vim,match){this.currentRegister=match[1]},"/^(p|P)$/":function(keys,vim,match){var P=match[1]==="P";var reg=this.register(this.currentRegister||0);if(!reg||!reg.length)return;if(_(reg).isArray()){while(reg.length){this.exec(reg.shift())}this.exec("esc")}else{this.exec(P?"i":"a");this.exec(reg);this.exec("esc")}},"/^(P)/":function(keys,vim,res){this.exec("i");this.exec(this.register(0));this.exec("esc")},"/^q([a-z]?)$/":function(keys,vim,res){if(this.recording){this.register(this.recordingRegister,this.recordingBuffer);this.recording=false}else if(res[1]){this.recording=true;this.recordingRegister=res[1];this.recordingBuffer=[];this.preRecordText=this.curDoc.text()}else{this.keyBuffer="q"}},"/^@([a-z])$/":function(keys,vim,res){var commands=this.register(res[1]);this.curDoc.last("macro",res[1]);if(typeof commands==="string"){this.exec(commands)}else{while(commands.length){this.exec(commands.shift())}}},"/^@@$/":function(){var last=this.curDoc.last("macro");if(last){this.exec("@"+last)}},"/^r(.)$/":function(keys,vim,match){this.exec("x");this.exec("i");this.exec(match[1]);this.exec("esc")},"/^([1-9]+[0-9]*)(x|X)$/":function(keys,vim,match){if(this.execDepth===1){this.addUndoState()}var ct=parseInt(match[1]);while(ct--){vim.exec(match[2])}},"/^x$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}var range=this.curDoc.selection();if(range[0].line===range[1].line&!this.curDoc.line(range[0].line).length){return}this.exec("v");this.exec("d")},"/^X$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}this.exec("h");this.exec("x")},"/^D$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}this.exec("d");this.exec("$")},"/^C$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}this.exec("c");this.exec("$")},"/^s$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}this.exec("c");this.exec("l")},"/^S$/":function(keys,vim,res){if(this.execDepth===1){this.addUndoState()}this.exec("c");this.exec("c")},"/^u$/":function(keys,vim,res){if(this.execDepth===1){if(this.addUndoState()){this.curDoc.undo.last()}}var state=this.curDoc.undo.last();if(!state)return;this.curDoc.text(state.text);this.curDoc.cursor.char(state.cursor.char);this.curDoc.cursor.line(state.cursor.line)},"/<C-r>/":function(keys,vim,res){var state=this.curDoc.undo.next();if(!state)return;this.curDoc.text(state.text);this.curDoc.cursor.char(state.cursor.char);this.curDoc.cursor.line(state.cursor.line)},"/:say (.*)\\n/":function(exCommand){this.notify("hey!")},"/:(.*)↑/":function(){var hist=this.histories[":"];var pos=hist.position;if(pos>0)pos--;this.histories[":"].position=pos;this.keyBuffer==="";this.exec(":");this.exec(hist[pos])},"/:(.*)↓/":function(){var hist=this.histories[":"];var pos=hist.position;if(pos>hist.length-1)pos=hist.length-1;if(pos<hist.length-1)pos++;this.histories[":"].position=pos;this.keyBuffer==="";this.exec("esc");this.exec(":");this.exec(hist[pos])},"/^:abbreviate (.*?) (.*)\n$/":function(keys,vim,expr){var key=expr[1];var val=expr[2];this.rc.abbreviations[key]=val},"/^:ab (.*?) (.*)\n$/":function(keys){this.exec(keys.replace(/:ab/,":abbreviate"))},"/^~$/":function(){var curChar=this.curChar;this.exec("r");this.exec(this.curChar===this.curChar.toLowerCase()?this.curChar.toUpperCase():this.curChar.toLowerCase());this.exec("esc")},"/^%$/":function(){var pos=this.curDoc.cursor.position();var table={"{":"}","}":"{","(":")",")":"(",f:"F",F:"f"};var seeking=table[this.curChar];var verb="{(".indexOf(this.curChar)>-1?"f":"F";this.exec(verb+seeking);this.exec(table[verb]+table[seeking]);var ct=1;var last=false;while(pos.char!==this.curDoc.cursor.char()||pos.line!==this.curDoc.cursor.line()){if(last){this.curDoc.cursor.line(pos.line);this.curDoc.cursor.char(pos.char);return}this.curDoc.cursor.line(pos.line);this.curDoc.cursor.char(pos.char);if(ct>10)throw"recursion in complement seeking";ct++;this.exec(""+ct+verb+seeking);last=this.curDoc.cursor.line()===this.curDoc._lines.length-1&&this.curDoc.cursor.char()>=this.curDoc._lines[this.curDoc.cursor.line()].length-1;this.exec(""+ct+table[verb]+table[seeking])}this.exec(""+ct+verb+seeking)},"/^m([a-z.])$/":function(keys,vim,expr){var pos=this.curDoc.cursor.position();var mark={col:pos.char,line:pos.line,file:this.curDoc.path||"",mark:expr[1]};this.curDoc.addMark(mark)},"/^('|`)([a-z.<>])$/":function(keys,vim,expr){var markName=expr[2];if(markName in this.curDoc._marks){var docMark=this.curDoc._marks[markName];var mark=this.curDoc.getMark(expr[2]);if(mark){this.curDoc.cursor.line(mark.line);if(expr[1]==="`")this.curDoc.cursor.char(mark.col);return}}this.notify("E20: Mark not set")}}},{underscore:18}],14:[function(require,module,exports){var _=require("underscore");var mark=require("../mark");module.exports={"/^((?!\b|esc)[\\w\\W][\\w\\W]+)$/":function(keys,vim){for(var i=0;i<keys.length;i++){this.exec(keys.substring(i,i+1))}},"/^((?!\b|esc|}).)$/":function(keys,vim,match){this.currentInsertedText+=keys;vim.insert(keys)},"/^}$/":function(){if(this.rc.smartindent&&this.curDoc._lines[this.curDoc.cursor.line()].match(/^\s*$/)){var ct=this.rc.tabstop;this.exec("esc");while(ct--){this.exec("X")}this.exec("i")}this.insert("}")},"/^\n$/":function(keys){this.currentInsertedText+=keys;if(!this.rc.smartindent||this.curDoc._lines[this.curDoc.cursor.line()].length===0){this.insert("\n")}else{var thisLine=this.curDoc._lines[this.curDoc.cursor.line()];var indent=thisLine.match(/{\s*(?:\/\/.*|\/\*.*\*\/\s*)?$/);curChar=this.curDoc.cursor.char();var currentText=this.currentInsertedText;this.exec("esc");this.exec("^");var ct=this.curDoc.cursor.char();if(thisLine.match(/^\s*$/)){ct=0}this.curDoc.cursor.char(curChar);this.insert("\n");if(indent){ct+=this.rc.tabstop}this.exec("i");this.currentInsertedText=currentText;while(ct-->0){this.exec(" ")}}},"/^(\b)$/":function(keys,vim){if(this.currentInsertedText.length)this.currentInsertedText=this.currentInsertedText.substring(0,this.currentInsertedText.length-1);var atZero=!vim.curDoc.cursor.char();vim.exec("esc");if(atZero&!vim.curDoc.cursor.line())return;if(atZero&&vim.curDoc.cursor.line()){vim.exec("k");vim.exec("J");vim.exec("x")}else{vim.exec("x")}vim.exec("i")},"/^esc/":function(keys,vim){vim.mode("command");vim.exec("h");if(this.submode==="block"&!this.currentInsertedText.match(/\n/)){this.submode="";var lastText=this.currentInsertedText;var meaningfulSelection=this.lastSelection.slice(1);_(meaningfulSelection).each(function(range){if(this.submodeVerb==="I"){this.curDoc.cursor.position(range[0]);this.exec("i")}else if(this.submodeVerb==="A"){var newPos=range[1];newPos.char--;newPos.col--;this.curDoc.cursor.position(range[1]);this.exec("a")}this.exec(lastText);this.exec("esc")},this);this.curDoc.cursor.position(this.lastSelection[0][0])}this.register(".",this.currentInsertedText);this.currentInsertedText=this.currentInsertedText.substring(0,0)}}},{"../mark":11,underscore:18}],16:[function(require,module,exports){!function(){var _=require("underscore");var mark=require("../mark");var rangeStart,originalCursorPosition=false;module.exports={"/^((?![1-9])(?!esc|x|d|y|i|a|J|c|>|<|~|g~|gu|gU).*[^1-9]+.*)/":function(keys,vim,res){this.curDoc.selecting=true;if(this.submode==="block"){if(keys==="C"){this.exec("$");this.exec("c");return}if(keys==="I"||keys==="A"){this.submodeVerb=keys;this.submode==="";if(keys==="A"){var pos=this.curDoc.selection()[0][1];pos.char--;pos.col--}this.exec("esc");if(keys==="A"){this.curDoc.cursor.position(pos);this.exec("a")}else{this.exec("i")}this.submode="block";return}}if(!originalCursorPosition){originalCursorPosition=this.curDoc.cursor.position()}this.lastMode="visual";this.mode("command");this.exec(keys);var pos=this.curDoc.cursor.position();this.rangeEnd=pos;var range=[JSON.parse(JSON.stringify(this.rangeStart)),JSON.parse(JSON.stringify(this.rangeEnd))];if(this.rangeEnd.line<this.rangeStart.line||this.rangeEnd.line===this.rangeStart.line&&this.rangeEnd.char<this.rangeStart.char){range=[range[1],range[0]]}range[1].char++;range[0].col=range[0].char;range[0].mark="<";range[1].col=range[1].char;range[1].mark=">";this.curDoc.addMark(range[0]);this.curDoc.addMark(range[1]);if(this.submode==="Visual"){range[0].char=0;var line=this.curDoc.line(range[1].line);range[1].char=this.curDoc.line(range[1].line).length}if(this.submode==="block"){var curLine=range[0].line;var lastLine=range[1].line;var firstCol,lastCol;if(range[1].char<=range[0].char){firstCol=range[1].char-1;lastCol=range[0].char+1}else{firstCol=range[0].char;lastCol=range[1].char}blockRange=[];while(curLine<=range[1].line){if(firstCol>=this.curDoc._lines[curLine].length){curLine++;continue}var lastLineCol=Math.min(this.curDoc._lines[curLine].length,lastCol);var pos=this.curDoc.cursor.position();if(curLine===pos.line&&lastLineCol===pos.col){lastLineCol++}blockRange.push([{line:curLine,"char":firstCol,col:firstCol},{line:curLine,"char":lastLineCol,col:lastLineCol}]);curLine++}if(blockRange.length===1)blockRange=blockRange[0];range=blockRange}this.curDoc.selection(range);if(this.modeName==="command")this.mode("visual")},"/^c$/":function(){if(this.submode==="block"){var newSelection=JSON.parse(JSON.stringify(this.curDoc.selection()));if("line"in newSelection[0]){newSelection=[newSelection]}_(newSelection).each(function(subRange,i){var newEnd=subRange[1];newEnd.char++;newEnd.col++;newSelection[i][1]=newEnd});this.exec("d");this.exec("<Ctrl-v>");this.curDoc.selection(newSelection);this.exec("I");return}this.exec("d");this.exec("i")},"/^d$/":function(){var sel=this.curDoc.selection();this.exec("y");this.exec("v");this.curDoc.selection(sel);var doc=this.curDoc;var range=doc.selection();doc.remove(range);doc.selection("reset");if(range[0].line>=doc._lines.length){var newLine=doc._lines.length-1;if(newLine<0)newLine=0;doc.cursor.line(newLine)}else{doc.cursor.line(range[0].line)}doc.cursor.char(range[0].char);this.exec("esc")},"/^y$/":function(){var selection=this.curDoc.getRange(this.curDoc.selection());var index=this.currentRegister;this.register(index,selection);this.curDoc.cursor.position(this.curDoc.selection()[0]);this.curDoc.selection("reset");this.exec("esc")},"/^~$/":function(){this.exec("g~")},"/^g~$/":function(){var selection=this.curDoc.selection();if(!selection[0].length){selection=[selection]}_(selection).each(function(subRange){var text=this.curDoc.getRange(subRange);var newText=mark("");for(var i=0;i<text.length;i++){var newChar=text[i]===text[i].toLowerCase()?text[i].toUpperCase():text[i].toLowerCase();newText=newText.concat(newChar)}this.curDoc.selection(selection);this.curDoc.exec("d");this.curDoc.exec("i");this.exec(newText);this.exec("esc")},this)},"/^gu$/":function(){var selection=this.curDoc.selection();if(!selection[0].length){selection=[selection]}_(selection).each(function(subRange){var text=this.curDoc.getRange(subRange);var newText=mark("");for(var i=0;i<text.length;i++){var newChar=text[i].toLowerCase();newText=newText.concat(newChar)}this.curDoc.selection(selection);this.curDoc.exec("d");this.curDoc.exec("i");this.exec(newText);this.exec("esc")},this)},"/^gU$/":function(){var selection=this.curDoc.selection();if(!selection[0].length){selection=[selection]}_(selection).each(function(subRange){var text=this.curDoc.getRange(subRange);var newText=mark("");for(var i=0;i<text.length;i++){var newChar=text[i].toUpperCase();newText=newText.concat(newChar)}this.curDoc.selection(selection);this.curDoc.exec("d");this.curDoc.exec("i");this.exec(newText);this.exec("esc")},this)},"/^!$/":function(){},"/^=$/":function(){},"/^gq$/":function(){},"/^g?$/":function(){},"/^>$/":function(){var selection=this.curDoc.selection();var ct=selection[1].line-selection[0].line+1;this.curDoc.cursor.line(selection[0].line);while(ct>0){this.exec("0");this.mode("insert");this.exec("	");this.mode("visual");this.exec("j");ct--}this.exec("esc");this.exec("^")},"/^<$/":function(){},"/^zf$/":function(){},"/^g@$/":function(){},"/^([1-9]+[0-9]*)?(a|i)(w|W|s|S|p|\\]|\\[|\\(|\\)|b|>|<|t|\\{|\\}|\"|'|`)$/":function(keys,vim,match){var outer=match[2]==="a";var count=1;if(match[1]&&match[1].length)count=parseInt(match[1]);var boundaries=[];var boundaryMap={w:["b","e"],W:["F ","f "],'"':['F"','f"'],s:["(",")"],"(":["F(","f)"]};if(match[3]in boundaryMap){boundaries=boundaryMap[match[3]]}else{boundaries=[match[3],match[3]]}var moveIn=false;if(boundaries[0].substring(0,1)==="F"&&match[2]==="i"){boundaries[0]="T"+boundaries[0].substring(1);boundaries[1]="t"+boundaries[1].substring(1)}else if(match[2]==="i"){moveIn=true}if(boundaries.length){this.exec("esc");var i=0;while(i++<count){this.exec(boundaryMap[match[3]][0])}if(moveIn)this.exec("l");this.exec("v");var i=0;while(i++<count){this.exec(boundaryMap[match[3]][1])}if(moveIn)this.exec("h")}},"/^esc/":function(keys,vim){this.lastSelection=JSON.parse(JSON.stringify(this.curDoc.selection()));this.rangeStart=false;this.curDoc.selection("reset");this.curDoc.selecting=false;this.curDoc.cursor.position(originalCursorPosition);originalCursorPosition=false;this.submode=false},"/^(x)$/":function(keys,vim){this.exec("d")},"/^(J)$/":function(keys,vim){var range=this.curDoc.selection();var ct=range[1].line-range[0].line||1;this.curDoc.cursor.line(range[0].line);this.exec("esc");while(ct--){this.exec("J")}}}}()},{"../mark":11,underscore:18}],25:[function(require,module,exports){var hex2rgbString=require("rgb"),x256=require("x256"),rgbRegExp=/(\d+),(\d+),(\d+)/;var mauve;function getPrefix(scheme){return'<span style="'+(scheme.fg?"color:"+scheme.fg+";":"")+(scheme.bg?"background-color:"+scheme.bg+";":"")+(scheme.misc?"font-weight:700;":"")+'">'}mauve=function(raw){var freshString=new String(raw);if(typeof window!=="undefined"){for(var scheme in mauve.hash){freshString[mauve.hash[scheme].name]=new String(getPrefix(mauve.hash[scheme])+raw+"</span>");freshString[mauve.hash[scheme].name].substring=function(){return getPrefix(mauve.hash[scheme])+raw.substring.apply(raw,arguments)+"</span>"}}}return freshString};mauve.hash={};mauve.set=function(name,color){if(typeof name==="object"){for(var i in name){this.set(i,name[i])}return}var scheme={};var fg=false;var bg=false;var misc=false;if(color.indexOf("#")>-1){var colors=color.split("/");var fg=colors[0].length?hex2Address(colors[0]):false;scheme.fg=colors[0];var bg=colors[1]?hex2Address(colors[1]):false;scheme.bg=colors[1];this.hash[name]=scheme;this.hash[name].name=name}else{switch(color){case"bold":misc="[1m";this.hash[name]={misc:"bold",name:name};break}}if(typeof window==="undefined"){String.prototype.substring=function(start,end){if(start===end)return"";if(!end)end=this.length;var text="";var raw=this.split("");var index=0;var inEscape=false;var curChar;var currentCommand="";while(index<start){curChar=raw.shift();if(inEscape){currentCommand+=curChar;if(curChar==="m"){inEscape=false}continue}else{if(curChar===""){inEscape=true;currentCommand=curChar;continue}index++}}if(currentCommand!=="[0m"){text+=currentCommand}while(index<end&&raw.length){curChar=raw.shift();text+=curChar;if(inEscape){if(curChar==="m"){inEscape=false}continue}else{if(curChar===""){inEscape=true;continue}}index++}return text};String.prototype.__defineGetter__(name,function(){var raw=this.replace(/\u001B(?:.*)m/,"");var result="";if(fg)result+="[38;5;"+fg+"m";if(bg)result+="[48;5;"+bg+"m";if(misc)result+=misc;result+=raw+"[0m";return result})}};function hex2Address(hex){var rgb=hex2rgbString(hex);var nums=rgbRegExp.exec(rgb);return x256(parseInt(nums[1]),parseInt(nums[2]),parseInt(nums[3]))}module.exports=mauve},{x256:26,rgb:27}],27:[function(require,module,exports){"use strict";var colors={maroon:"#800000",red:"#ff0000",orange:"#ffA500",yellow:"#ffff00",olive:"#808000",purple:"#800080",fuchsia:"#ff00ff",white:"#ffffff",lime:"#00ff00",green:"#008000",navy:"#000080",blue:"#0000ff",aqua:"#00ffff",teal:"#008080",black:"#000000",silver:"#c0c0c0",gray:"#808080",transparent:"#0000"};var RGBtoRGB=function(r,g,b,a){if(a==null||a==="")a=1;r=parseFloat(r);g=parseFloat(g);b=parseFloat(b);a=parseFloat(a);if(!(r<=255&&r>=0&&g<=255&&g>=0&&b<=255&&b>=0&&a<=1&&a>=0))return null;return[Math.round(r),Math.round(g),Math.round(b),a]};var HEXtoRGB=function(hex){if(hex.length===3)hex+="f";if(hex.length===4){var h0=hex.charAt(0),h1=hex.charAt(1),h2=hex.charAt(2),h3=hex.charAt(3);hex=h0+h0+h1+h1+h2+h2+h3+h3}if(hex.length===6)hex+="ff";var rgb=[];for(var i=0,l=hex.length;i<l;i+=2)rgb.push(parseInt(hex.substr(i,2),16)/(i===6?255:1));return rgb};var HUEtoRGB=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p};var HSLtoRGB=function(h,s,l,a){var r,b,g;if(a==null||a==="")a=1;h=parseFloat(h)/360;s=parseFloat(s)/100;l=parseFloat(l)/100;a=parseFloat(a)/1;if(h>1||h<0||s>1||s<0||l>1||l<0||a>1||a<0)return null;if(s===0){r=b=g=l}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=HUEtoRGB(p,q,h+1/3);g=HUEtoRGB(p,q,h);b=HUEtoRGB(p,q,h-1/3)}return[r*255,g*255,b*255,a]};var keys=[];for(var c in colors)keys.push(c);var shex="(?:#([a-f0-9]{3,8}))",sval="\\s*([.\\d%]+)\\s*",sop="(?:,\\s*([.\\d]+)\\s*)?",slist="\\("+[sval,sval,sval]+sop+"\\)",srgb="(?:rgb)a?",shsl="(?:hsl)a?",skeys="("+keys.join("|")+")";var xhex=RegExp(shex,"i"),xrgb=RegExp(srgb+slist,"i"),xhsl=RegExp(shsl+slist,"i");var color=function(input,array){if(input==null)return null;input=(input+"").replace(/\s+/,"");var match=colors[input];if(match){return color(match,array)}else if(match=input.match(xhex)){input=HEXtoRGB(match[1])}else if(match=input.match(xrgb)){input=match.slice(1)}else if(match=input.match(xhsl)){input=HSLtoRGB.apply(null,match.slice(1))}else return null;if(!(input&&(input=RGBtoRGB.apply(null,input))))return null;if(array)return input;if(input[3]===1)input.splice(3,1);return"rgb"+(input.length===4?"a":"")+"("+input+")"};var regexp=RegExp([skeys,shex,srgb+slist,shsl+slist].join("|"),"gi");color.replace=function(string,method){if(!method)method=function(match){return color(match)};return(string+"").replace(regexp,method)};color.matches=function(string){return!!(string+"").match(regexp)};module.exports=color},{}],26:[function(require,module,exports){var colors=require("./colors.json").map(function(hex){var r=parseInt(hex.slice(0,2),16);var g=parseInt(hex.slice(2,4),16);var b=parseInt(hex.slice(4,6),16);return[r,g,b]});var x256=module.exports=function(r,g,b){var c=Array.isArray(r)?r:[r,g,b];var best=null;for(var i=0;i<colors.length;i++){var d=distance(colors[i],c);if(!best||d<=best.distance){best={distance:d,index:i}}}return best.index};x256.colors=colors;function distance(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}},{"./colors.json":28}],28:[function(require,module,exports){module.exports=["000000","800000","008000","808000","000080","800080","008080","c0c0c0","808080","ff0000","00ff00","ffff00","0000ff","ff00ff","00ffff","ffffff","000000","00005f","000087","0000af","0000d7","0000ff","005f00","005f5f","005f87","005faf","005fd7","005fff","008700","00875f","008787","0087af","0087d7","0087ff","00af00","00af5f","00af87","00afaf","00afd7","00afff","00d700","00d75f","00d787","00d7af","00d7d7","00d7ff","00ff00","00ff5f","00ff87","00ffaf","00ffd7","00ffff","5f0000","5f005f","5f0087","5f00af","5f00d7","5f00ff","5f5f00","5f5f5f","5f5f87","5f5faf","5f5fd7","5f5fff","5f8700","5f875f","5f8787","5f87af","5f87d7","5f87ff","5faf00","5faf5f","5faf87","5fafaf","5fafd7","5fafff","5fd700","5fd75f","5fd787","5fd7af","5fd7d7","5fd7ff","5fff00","5fff5f","5fff87","5fffaf","5fffd7","5fffff","870000","87005f","870087","8700af","8700d7","8700ff","875f00","875f5f","875f87","875faf","875fd7","875fff","878700","87875f","878787","8787af","8787d7","8787ff","87af00","87af5f","87af87","87afaf","87afd7","87afff","87d700","87d75f","87d787","87d7af","87d7d7","87d7ff","87ff00","87ff5f","87ff87","87ffaf","87ffd7","87ffff","af0000","af005f","af0087","af00af","af00d7","af00ff","af5f00","af5f5f","af5f87","af5faf","af5fd7","af5fff","af8700","af875f","af8787","af87af","af87d7","af87ff","afaf00","afaf5f","afaf87","afafaf","afafd7","afafff","afd700","afd75f","afd787","afd7af","afd7d7","afd7ff","afff00","afff5f","afff87","afffaf","afffd7","afffff","d70000","d7005f","d70087","d700af","d700d7","d700ff","d75f00","d75f5f","d75f87","d75faf","d75fd7","d75fff","d78700","d7875f","d78787","d787af","d787d7","d787ff","d7af00","d7af5f","d7af87","d7afaf","d7afd7","d7afff","d7d700","d7d75f","d7d787","d7d7af","d7d7d7","d7d7ff","d7ff00","d7ff5f","d7ff87","d7ffaf","d7ffd7","d7ffff","ff0000","ff005f","ff0087","ff00af","ff00d7","ff00ff","ff5f00","ff5f5f","ff5f87","ff5faf","ff5fd7","ff5fff","ff8700","ff875f","ff8787","ff87af","ff87d7","ff87ff","ffaf00","ffaf5f","ffaf87","ffafaf","ffafd7","ffafff","ffd700","ffd75f","ffd787","ffd7af","ffd7d7","ffd7ff","ffff00","ffff5f","ffff87","ffffaf","ffffd7","ffffff","080808","121212","1c1c1c","262626","303030","3a3a3a","444444","4e4e4e","585858","606060","666666","767676","808080","8a8a8a","949494","9e9e9e","a8a8a8","b2b2b2","bcbcbc","c6c6c6","d0d0d0","dadada","e4e4e4","eeeeee"]},{}]},{},[2]);